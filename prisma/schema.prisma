// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  email     String @unique
  password  String
  name      String?
  cpf       String?
  dataNasc  String?
  profissao String?
  titulo    String?
  // Relacionamentos
  movements MovementRecord[]
  projects  Project[]
}

model Material {
  id         String @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  category   String
  supplier   String
  quantity   Int
  unit       String
  price      Float
  status     String
  minStock   Int
  notes      String?
  // Relacionamento
  movements  MovementRecord[]
}

model MovementRecord {
  id                String @id @default(auto()) @map("_id") @db.ObjectId
  userId            String @db.ObjectId
  materialId        String @db.ObjectId
  projectId         String @db.ObjectId // Novo campo para o relacionamento com Project
  userName          String
  materialName      String
  materialCategory  String
  actionType        String
  quantity          Int
  date              DateTime
  location          String
  justification     String
  
  // Relacionamentos
  user              User      @relation(fields: [userId], references: [id])
  material          Material  @relation(fields: [materialId], references: [id])
  project           Project   @relation(fields: [projectId], references: [id])
}

// Novo modelo para Projects
model Project {
  id          String @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  userId      String @db.ObjectId
  // Relacionamentos
  user        User @relation(fields: [userId], references: [id])
  movements   MovementRecord[]
}