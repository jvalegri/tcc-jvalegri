(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1694:function(e,a,s){Promise.resolve().then(s.bind(s,4502))},4502:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return aw}});var t=s(7437),r=s(2265),i=s(1994),n=s(3335);function o(){for(var e=arguments.length,a=Array(e),s=0;s<e;s++)a[s]=arguments[s];return(0,n.m6)((0,i.W)(a))}var l=s(7053),d=s(535);let c=(0,d.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),m=r.forwardRef((e,a)=>{let{className:s,variant:r,size:i,asChild:n=!1,...d}=e,m=n?l.g7:"button";return(0,t.jsx)(m,{className:o(c({variant:r,size:i,className:s})),ref:a,...d})});m.displayName="Button";var u=s(5466),x=s(4794),h=s(7404),p=s(5621),j=s(5805),f=s(2489),v=s(2369),g=s(6475),N=s(7692);let y=[{id:"dashboard",name:"Dashboard",icon:u.Z,roles:["GESTOR","COLABORADOR"]},{id:"materials",name:"Materiais",icon:x.Z,roles:["GESTOR","COLABORADOR"]},{id:"scanner",name:"Scanner QR",icon:h.Z,roles:["GESTOR","COLABORADOR"]},{id:"movements",name:"Movimenta\xe7\xf5es",icon:p.Z,roles:["GESTOR","COLABORADOR"]},{id:"users",name:"Gest\xe3o de Usu\xe1rios",icon:j.Z,roles:["GESTOR"]}];function b(e){let{currentPage:a,setCurrentPage:s,sidebarOpen:r,setSidebarOpen:i,onLogout:n,currentUserRole:l,projectName:d,onBackToProjects:c}=e,u=y.filter(e=>!l||e.roles.includes(l));return(0,t.jsxs)(t.Fragment,{children:[r&&(0,t.jsx)("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-50 md:hidden",onClick:()=>i(!1)}),(0,t.jsxs)("div",{className:o("fixed inset-y-0 left-0 z-50 w-64 bg-card border-r transform transition-transform duration-200 ease-in-out md:relative md:translate-x-0 flex flex-col",r?"translate-x-0":"-translate-x-full"),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("h1",{className:"text-xl font-bold",children:"EasyStock"}),d&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground font-medium truncate",children:d})]}),(0,t.jsx)(m,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>i(!1),children:(0,t.jsx)(f.Z,{className:"h-4 w-4"})})]}),(0,t.jsx)("nav",{className:"p-4 space-y-2 flex-1",children:u.map(e=>{let r=e.icon;return(0,t.jsxs)(m,{variant:a===e.id?"default":"ghost",className:"w-full justify-start",onClick:()=>{s(e.id),i(!1)},children:[(0,t.jsx)(r,{className:"mr-2 h-4 w-4"}),e.name]},e.id)})}),(0,t.jsxs)("div",{className:"p-4 border-t space-y-2",children:[(0,t.jsxs)(m,{variant:"outline",className:"w-full justify-start",onClick:()=>{s("profile"),i(!1)},children:[(0,t.jsx)(v.Z,{className:"mr-2 h-4 w-4"}),"Perfil"]}),(0,t.jsxs)(m,{variant:"outline",className:"w-full justify-start",onClick:()=>{null==c||c(),i(!1)},children:[(0,t.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),"Meus Projetos"]}),(0,t.jsxs)(m,{variant:"outline",className:"w-full justify-start text-destructive hover:text-destructive hover:bg-destructive/10",onClick:n,children:[(0,t.jsx)(N.Z,{className:"mr-2 h-4 w-4"}),"Sair"]})]})]})]})}var w=s(8293),S=s(8420),C=s(5929),k=s(7226),E=s(5922);let R={dashboard:"Dashboard",materials:"Materiais",scanner:"Scanner QR",movements:"Movimenta\xe7\xf5es",profile:"Perfil",users:"Gest\xe3o de Usu\xe1rios"};function T(e){let{currentPage:a,setSidebarOpen:s,projectName:r}=e,{theme:i,setTheme:n}=(0,E.F)();return(0,t.jsxs)("header",{className:"bg-card border-b px-4 py-3 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(m,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>s(!0),children:(0,t.jsx)(w.Z,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[r&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(S.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:r}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"•"})]}),(0,t.jsx)("h2",{className:"text-lg font-semibold",children:R[a]})]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)(m,{variant:"ghost",size:"icon",onClick:()=>n("dark"===i?"light":"dark"),children:[(0,t.jsx)(C.Z,{className:"h-4 w-4 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),(0,t.jsx)(k.Z,{className:"absolute h-4 w-4 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"})]})})]})}let O=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("div",{ref:a,className:o("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});O.displayName="Card";let P=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("div",{ref:a,className:o("flex flex-col space-y-1.5 p-6",s),...r})});P.displayName="CardHeader";let q=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("div",{ref:a,className:o("text-2xl font-semibold leading-none tracking-tight",s),...r})});q.displayName="CardTitle";let D=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("div",{ref:a,className:o("text-sm text-muted-foreground",s),...r})});D.displayName="CardDescription";let A=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("div",{ref:a,className:o("p-6 pt-0",s),...r})});A.displayName="CardContent",r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("div",{ref:a,className:o("flex items-center p-6 pt-0",s),...r})}).displayName="CardFooter";let F=(0,d.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function L(e){let{className:a,variant:s,...r}=e;return(0,t.jsx)("div",{className:o(F({variant:s}),a),...r})}var Z=s(6865),z=s(8736),U=s(9397);let M=(0,s(3011).U)((e,a)=>({materials:[],movements:[],currentProjectId:null,currentUserId:null,isLoading:!1,error:null,setMaterials:a=>e({materials:a}),setMovements:a=>e({movements:a}),setCurrentProjectId:a=>e({currentProjectId:a}),setCurrentUserId:a=>e({currentUserId:a}),setError:a=>e({error:a}),fetchMaterials:async a=>{try{e({isLoading:!0,error:null});let s=await fetch("/api/materials?projectId=".concat(a));if(!s.ok)throw Error("Erro ao buscar materiais: ".concat(s.status));let t=await s.json();e({materials:t,isLoading:!1})}catch(a){throw console.error("Erro ao buscar materiais:",a),e({error:a instanceof Error?a.message:"Erro desconhecido",isLoading:!1}),a}},fetchMovements:async a=>{try{e({isLoading:!0,error:null});let s=await fetch("/api/movements?projectId=".concat(a));if(!s.ok)throw Error("Erro ao buscar movimenta\xe7\xf5es: ".concat(s.status));let t=await s.json();e({movements:t,isLoading:!1})}catch(a){throw console.error("Erro ao buscar movimenta\xe7\xf5es:",a),e({error:a instanceof Error?a.message:"Erro desconhecido",isLoading:!1}),a}},addMaterial:async(a,s)=>{try{e({isLoading:!0,error:null});let s=await fetch("/api/materials",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok)throw Error("Erro ao adicionar material: ".concat(s.status));let t=await s.json();e(e=>({materials:[...e.materials,t],isLoading:!1}))}catch(a){throw console.error("Erro ao adicionar material:",a),e({error:a instanceof Error?a.message:"Erro desconhecido",isLoading:!1}),a}},updateMaterial:async(a,s)=>{try{e({isLoading:!0,error:null});let t={id:a,name:s.name,description:s.notes,type:s.category,currentQuantity:s.quantity,unit:s.unit,price:s.price,supplier:s.supplier,minStock:s.minStock},r=await fetch("/api/materials",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error("Erro ao atualizar material: ".concat(r.status));let i=await r.json();e(e=>({materials:e.materials.map(e=>e.id===a?i:e),isLoading:!1}))}catch(a){throw console.error("Erro ao atualizar material:",a),e({error:a instanceof Error?a.message:"Erro desconhecido",isLoading:!1}),a}},updateMaterialQuantity:(a,s)=>{e(e=>({materials:e.materials.map(e=>e.id===a?{...e,quantity:s}:e)}))},deleteMaterial:a=>{e(e=>({materials:e.materials.filter(e=>e.id!==a)}))},addMovement:async(a,s,t)=>{try{e({isLoading:!0,error:null});let r=await fetch("/api/movements",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...a,projectId:s,userId:t})});if(!r.ok)throw Error("Erro ao adicionar movimenta\xe7\xe3o: ".concat(r.status));let i=await r.json();e(e=>({movements:[...e.movements,i],isLoading:!1})),"entrada"===a.type?e(e=>({materials:e.materials.map(e=>e.id===a.materialId?{...e,quantity:e.quantity+a.quantity}:e)})):e(e=>({materials:e.materials.map(e=>e.id===a.materialId?{...e,quantity:Math.max(0,e.quantity-a.quantity)}:e)}))}catch(a){throw console.error("Erro ao adicionar movimenta\xe7\xe3o:",a),e({error:a instanceof Error?a.message:"Erro desconhecido",isLoading:!1}),a}},clearData:()=>{e({materials:[],movements:[],currentProjectId:null,currentUserId:null,isLoading:!1,error:null})}}));var I=s(9027);let _=I.fC,B=I.xz,V=I.h_;I.x8;let Q=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(I.aV,{ref:a,className:o("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});Q.displayName=I.aV.displayName;let G=r.forwardRef((e,a)=>{let{className:s,children:r,...i}=e;return(0,t.jsxs)(V,{children:[(0,t.jsx)(Q,{}),(0,t.jsxs)(I.VY,{ref:a,className:o("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...i,children:[r,(0,t.jsxs)(I.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,t.jsx)(f.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});G.displayName=I.VY.displayName;let J=e=>{let{className:a,...s}=e;return(0,t.jsx)("div",{className:o("flex flex-col space-y-1.5 text-center sm:text-left",a),...s})};J.displayName="DialogHeader";let Y=e=>{let{className:a,...s}=e;return(0,t.jsx)("div",{className:o("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s})};Y.displayName="DialogFooter";let $=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(I.Dx,{ref:a,className:o("text-lg font-semibold leading-none tracking-tight",s),...r})});$.displayName=I.Dx.displayName;let H=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(I.dk,{ref:a,className:o("text-sm text-muted-foreground",s),...r})});H.displayName=I.dk.displayName;let X=r.forwardRef((e,a)=>{let{className:s,type:r,...i}=e;return(0,t.jsx)("input",{type:r,className:o("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:a,...i})});X.displayName="Input";var W=s(6394);let K=(0,d.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ee=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(W.f,{ref:a,className:o(K(),s),...r})});ee.displayName=W.f.displayName;let ea=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("textarea",{className:o("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:a,...r})});ea.displayName="Textarea";let es=0,et=new Map,er=e=>{if(et.has(e))return;let a=setTimeout(()=>{et.delete(e),el({type:"REMOVE_TOAST",toastId:e})},1e6);et.set(e,a)},ei=(e,a)=>{switch(a.type){case"ADD_TOAST":return{...e,toasts:[a.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===a.toast.id?{...e,...a.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=a;return s?er(s):e.toasts.forEach(e=>{er(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===a.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==a.toastId)}}},en=[],eo={toasts:[]};function el(e){eo=ei(eo,e),en.forEach(e=>{e(eo)})}function ed(e){let{...a}=e,s=(es=(es+1)%Number.MAX_SAFE_INTEGER).toString(),t=()=>el({type:"DISMISS_TOAST",toastId:s});return el({type:"ADD_TOAST",toast:{...a,id:s,open:!0,onOpenChange:e=>{e||t()}}}),{id:s,dismiss:t,update:e=>el({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function ec(){let[e,a]=r.useState(eo);return r.useEffect(()=>(en.push(a),()=>{let e=en.indexOf(a);e>-1&&en.splice(e,1)}),[e]),{...e,toast:ed,dismiss:e=>el({type:"DISMISS_TOAST",toastId:e})}}function em(e){let{material:a,onSuccess:s}=e,{addMaterial:i,updateMaterial:n,currentProjectId:o}=M(),{toast:l}=ec(),[d,c]=(0,r.useState)({name:(null==a?void 0:a.name)||"",category:(null==a?void 0:a.category)||"",supplier:(null==a?void 0:a.supplier)||"",quantity:(null==a?void 0:a.quantity)||"",unit:(null==a?void 0:a.unit)||"un",price:(null==a?void 0:a.price)||"",minStock:(null==a?void 0:a.minStock)||"",notes:(null==a?void 0:a.notes)||""}),[u,x]=(0,r.useState)({}),h=()=>{let e={};d.name.trim()||(e.name="Nome \xe9 obrigat\xf3rio"),d.category.trim()||(e.category="Categoria \xe9 obrigat\xf3ria"),d.supplier.trim()||(e.supplier="Fornecedor \xe9 obrigat\xf3rio");let a=parseFloat(d.quantity.toString());(isNaN(a)||a<0)&&(e.quantity="Quantidade deve ser um n\xfamero positivo");let s=parseFloat(d.price.toString());(isNaN(s)||s<0)&&(e.price="Pre\xe7o deve ser um n\xfamero positivo");let t=parseFloat(d.minStock.toString());return(isNaN(t)||t<0)&&(e.minStock="Estoque m\xednimo deve ser um n\xfamero positivo"),x(e),0===Object.keys(e).length},p=async e=>{if(e.preventDefault(),h()){if(!o){l({title:"Erro",description:"Nenhum projeto selecionado. Selecione um projeto primeiro.",variant:"destructive"});return}try{if(a){let e={name:d.name,category:d.category,supplier:d.supplier,quantity:parseFloat(d.quantity.toString())||0,unit:d.unit,price:parseFloat(d.price.toString())||0,minStock:parseFloat(d.minStock.toString())||0,notes:d.notes,status:parseFloat(d.quantity.toString())<=parseFloat(d.minStock.toString())?0===parseFloat(d.quantity.toString())?"Sem Estoque":"Estoque Baixo":"Em Estoque"};await n(a.id,e),l({title:"Material atualizado",description:"Material foi atualizado com sucesso!"})}else{let e={name:d.name,description:d.notes,type:d.category,currentQuantity:parseFloat(d.quantity.toString())||0,unit:d.unit,price:parseFloat(d.price.toString())||0,supplier:d.supplier,minStock:parseFloat(d.minStock.toString())||0,isConsumable:!1,projectId:o};await i(e,o),l({title:"Material adicionado",description:"Novo material foi cadastrado com sucesso!"})}s()}catch(e){l({title:"Erro",description:"Erro ao salvar material. Tente novamente.",variant:"destructive"})}}},j=(e,a)=>{c(s=>({...s,[e]:a})),u[e]&&x(a=>({...a,[e]:""}))},f=(e,a)=>{(""===a||/^[0-9]*[.,]?[0-9]*$/.test(a))&&j(e,a)},v=e=>""===e||0===e?"":e.toString();return(0,t.jsxs)("form",{onSubmit:p,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(ee,{htmlFor:"name",children:"Nome *"}),(0,t.jsx)(X,{id:"name",value:d.name,onChange:e=>j("name",e.target.value),placeholder:"Ex: Tinta Acr\xedlica Branca"}),u.name&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:u.name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(ee,{htmlFor:"category",children:"Categoria *"}),(0,t.jsx)(X,{id:"category",value:d.category,onChange:e=>j("category",e.target.value),placeholder:"Ex: Tintas, Pisos, Ilumina\xe7\xe3o"}),u.category&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:u.category})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(ee,{htmlFor:"supplier",children:"Fornecedor *"}),(0,t.jsx)(X,{id:"supplier",value:d.supplier,onChange:e=>j("supplier",e.target.value),placeholder:"Ex: Suvinil, Portobello"}),u.supplier&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:u.supplier})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(ee,{htmlFor:"quantity",children:"Quantidade *"}),(0,t.jsx)(X,{id:"quantity",type:"text",value:v(d.quantity),onChange:e=>f("quantity",e.target.value),placeholder:"0",className:"font-mono"}),u.quantity&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:u.quantity}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Digite apenas n\xfameros. Use v\xedrgula ou ponto para decimais (ex: 3,5 ou 2.4)"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(ee,{htmlFor:"unit",children:"Unidade"}),(0,t.jsxs)("select",{id:"unit",value:d.unit,onChange:e=>j("unit",e.target.value),className:"w-full p-2 border rounded-md",children:[(0,t.jsx)("option",{value:"un",children:"Unidade"}),(0,t.jsx)("option",{value:"m\xb2",children:"Metro Quadrado"}),(0,t.jsx)("option",{value:"m",children:"Metro"}),(0,t.jsx)("option",{value:"cm",children:"Cent\xedmetro"}),(0,t.jsx)("option",{value:"mm",children:"Mil\xedmetro"}),(0,t.jsx)("option",{value:"kg",children:"Quilograma"}),(0,t.jsx)("option",{value:"g",children:"Grama"}),(0,t.jsx)("option",{value:"l",children:"Litro"}),(0,t.jsx)("option",{value:"ml",children:"Mililitro"}),(0,t.jsx)("option",{value:"cx",children:"Caixa"}),(0,t.jsx)("option",{value:"p\xe7",children:"Pe\xe7a"}),(0,t.jsx)("option",{value:"rol",children:"Rolo"}),(0,t.jsx)("option",{value:"pct",children:"Pacote"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(ee,{htmlFor:"price",children:"Pre\xe7o (R$) *"}),(0,t.jsx)(X,{id:"price",type:"text",value:v(d.price),onChange:e=>f("price",e.target.value),placeholder:"0,00",className:"font-mono"}),u.price&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:u.price}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Digite apenas n\xfameros e use v\xedrgula ou ponto para decimais"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(ee,{htmlFor:"minStock",children:"Estoque M\xednimo *"}),(0,t.jsx)(X,{id:"minStock",type:"text",value:v(d.minStock),onChange:e=>f("minStock",e.target.value),placeholder:"0",className:"font-mono"}),u.minStock&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:u.minStock}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Digite apenas n\xfameros. Use v\xedrgula ou ponto para decimais"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(ee,{htmlFor:"notes",children:"Observa\xe7\xf5es"}),(0,t.jsx)(ea,{id:"notes",value:d.notes,onChange:e=>j("notes",e.target.value),placeholder:"Informa\xe7\xf5es adicionais sobre o material...",rows:3})]}),!o&&(0,t.jsx)("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:(0,t.jsx)("p",{className:"text-sm text-yellow-800",children:"⚠️ Nenhum projeto selecionado. Selecione um projeto para adicionar materiais."})}),(0,t.jsx)("div",{className:"flex gap-2 pt-4",children:(0,t.jsxs)(m,{type:"submit",className:"flex-1",disabled:!o,children:[a?"Atualizar":"Cadastrar"," Material"]})})]})}var eu=s(1312);let ex=eu.zt,eh=eu.fC,ep=eu.xz,ej=r.forwardRef((e,a)=>{let{className:s,sideOffset:r=4,...i}=e;return(0,t.jsx)(eu.VY,{ref:a,sideOffset:r,className:o("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...i})});function ef(e){let{setCurrentPage:a}=e,{materials:s,movements:i}=M(),[n,o]=(0,r.useState)(!1),l=[...new Set(s.map(e=>e.category))].length,d=s.filter(e=>e.quantity<=e.minStock).length,c=i.slice(0,5);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)(O,{children:[(0,t.jsxs)(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(q,{className:"text-sm font-medium",children:"Tipos de Materiais"}),(0,t.jsx)(x.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(A,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:l}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Tipos diferentes de materiais registrados"})]})]}),(0,t.jsxs)(O,{children:[(0,t.jsxs)(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(q,{className:"text-sm font-medium",children:"Estoque Baixo"}),(0,t.jsx)(Z.Z,{className:"h-4 w-4 text-yellow-500"})]}),(0,t.jsxs)(A,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:d}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Requer aten\xe7\xe3o"})]})]}),(0,t.jsxs)(O,{children:[(0,t.jsxs)(P,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(q,{className:"text-sm font-medium",children:"Movimenta\xe7\xf5es"}),(0,t.jsx)(z.Z,{className:"h-4 w-4 text-blue-500"})]}),(0,t.jsxs)(A,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:i.length}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Total registradas"})]})]})]}),(0,t.jsxs)(O,{children:[(0,t.jsx)(P,{children:(0,t.jsx)(q,{children:"A\xe7\xf5es R\xe1pidas"})}),(0,t.jsx)(A,{children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)(_,{open:n,onOpenChange:o,children:[(0,t.jsx)(B,{asChild:!0,children:(0,t.jsxs)(m,{className:"h-20 flex flex-col gap-2",children:[(0,t.jsx)(U.Z,{className:"h-6 w-6"}),"Adicionar Material"]})}),(0,t.jsxs)(G,{className:"max-w-2xl",children:[(0,t.jsx)(J,{children:(0,t.jsx)($,{children:"Adicionar Novo Material"})}),(0,t.jsx)(em,{onSuccess:()=>o(!1)})]})]}),(0,t.jsxs)(m,{variant:"outline",className:"h-20 flex flex-col gap-2 bg-transparent",onClick:()=>a("scanner"),children:[(0,t.jsx)(h.Z,{className:"h-6 w-6"}),"Escanear QR"]}),(0,t.jsxs)(m,{variant:"outline",className:"h-20 flex flex-col gap-2 bg-transparent",onClick:()=>a("movements"),children:[(0,t.jsx)(z.Z,{className:"h-6 w-6"}),"Relat\xf3rios"]})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(O,{children:[(0,t.jsx)(P,{children:(0,t.jsx)(q,{children:"Materiais com Estoque Baixo"})}),(0,t.jsx)(A,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(ex,{children:s.filter(e=>e.quantity<=e.minStock).slice(0,5).map(e=>(0,t.jsxs)(eh,{children:[(0,t.jsx)(ep,{asChild:!0,children:(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md hover:bg-muted/50 cursor-help transition-colors",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.name}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e.category})]}),(0,t.jsxs)(L,{variant:"destructive",children:[e.quantity," ",e.unit]})]})}),(0,t.jsx)(ej,{className:"max-w-xs p-3",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"font-semibold text-amber-700 dark:text-amber-300",children:"⚠️ Estoque Baixo"}),(0,t.jsxs)("div",{className:"text-sm space-y-1",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"font-medium",children:"Material:"}),(0,t.jsx)("span",{children:e.name})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"font-medium",children:"Quantidade Atual:"}),(0,t.jsxs)("span",{className:"text-red-600 font-semibold",children:[e.quantity," ",e.unit]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"font-medium",children:"Estoque M\xednimo:"}),(0,t.jsxs)("span",{className:"text-amber-600 font-semibold",children:[e.minStock," ",e.unit]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"font-medium",children:"Deficit:"}),(0,t.jsxs)("span",{className:"text-red-600 font-semibold",children:[Math.max(0,e.minStock-e.quantity)," ",e.unit]})]}),e.price>0&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"font-medium",children:"Pre\xe7o Unit\xe1rio:"}),(0,t.jsxs)("span",{className:"text-green-600 font-semibold",children:["R$ ",e.price.toFixed(2)]})]})]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground pt-1 border-t",children:"Considere fazer um novo pedido"})]})})]},e.id))}),0===s.filter(e=>e.quantity<=e.minStock).length&&(0,t.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"Nenhum material com estoque baixo"})]})})]}),(0,t.jsxs)(O,{children:[(0,t.jsx)(P,{children:(0,t.jsx)(q,{children:"Movimenta\xe7\xf5es Recentes"})}),(0,t.jsx)(A,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[c.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.materialName}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["entrada"===e.actionType?"Entrada":"Sa\xedda"," - ",e.location]})]}),(0,t.jsxs)(L,{variant:"entrada"===e.actionType?"default":"secondary",children:["entrada"===e.actionType?"+":"-",e.quantity]})]},e.id)),0===c.length&&(0,t.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"Nenhuma movimenta\xe7\xe3o recente"})]})})]})]})]})}ej.displayName=eu.VY.displayName;let ev=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:a,className:o("w-full caption-bottom text-sm",s),...r})})});ev.displayName="Table";let eg=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("thead",{ref:a,className:o("[&_tr]:border-b",s),...r})});eg.displayName="TableHeader";let eN=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("tbody",{ref:a,className:o("[&_tr:last-child]:border-0",s),...r})});eN.displayName="TableBody",r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("tfoot",{ref:a,className:o("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...r})}).displayName="TableFooter";let ey=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("tr",{ref:a,className:o("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...r})});ey.displayName="TableRow";let eb=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("th",{ref:a,className:o("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...r})});eb.displayName="TableHead";let ew=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("td",{ref:a,className:o("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...r})});ew.displayName="TableCell",r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("caption",{ref:a,className:o("mt-4 text-sm text-muted-foreground",s),...r})}).displayName="TableCaption";var eS=s(85),eC=s(407),ek=s(401),eE=s(519);let eR=eS.fC,eT=eS.xz;eS.ZA,eS.Uv,eS.Tr,eS.Ee,r.forwardRef((e,a)=>{let{className:s,inset:r,children:i,...n}=e;return(0,t.jsxs)(eS.fF,{ref:a,className:o("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",s),...n,children:[i,(0,t.jsx)(eC.Z,{className:"ml-auto"})]})}).displayName=eS.fF.displayName,r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(eS.tu,{ref:a,className:o("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r})}).displayName=eS.tu.displayName;let eO=r.forwardRef((e,a)=>{let{className:s,sideOffset:r=4,...i}=e;return(0,t.jsx)(eS.Uv,{children:(0,t.jsx)(eS.VY,{ref:a,sideOffset:r,className:o("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...i})})});eO.displayName=eS.VY.displayName;let eP=r.forwardRef((e,a)=>{let{className:s,inset:r,...i}=e;return(0,t.jsx)(eS.ck,{ref:a,className:o("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",s),...i})});eP.displayName=eS.ck.displayName,r.forwardRef((e,a)=>{let{className:s,children:r,checked:i,...n}=e;return(0,t.jsxs)(eS.oC,{ref:a,className:o("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:i,...n,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(eS.wU,{children:(0,t.jsx)(ek.Z,{className:"h-4 w-4"})})}),r]})}).displayName=eS.oC.displayName,r.forwardRef((e,a)=>{let{className:s,children:r,...i}=e;return(0,t.jsxs)(eS.Rk,{ref:a,className:o("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...i,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(eS.wU,{children:(0,t.jsx)(eE.Z,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=eS.Rk.displayName,r.forwardRef((e,a)=>{let{className:s,inset:r,...i}=e;return(0,t.jsx)(eS.__,{ref:a,className:o("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",s),...i})}).displayName=eS.__.displayName,r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(eS.Z0,{ref:a,className:o("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=eS.Z0.displayName;var eq=s(7782),eD=s(2208),eA=s(5868),eF=s(2735),eL=s(8930),eZ=s(5819);function ez(e){let{material:a}=e,{deleteMaterial:s}=M(),{toast:i}=ec(),[n,o]=(0,r.useState)(!1),[l,d]=(0,r.useState)(!1),c=async()=>{try{let e=await eZ.toDataURL(a.id),s=document.createElement("a");s.download="qr-".concat(a.name.replace(/\s+/g,"-").toLowerCase(),".png"),s.href=e,s.click(),i({title:"QR Code gerado",description:"QR Code do material foi baixado com sucesso!"})}catch(e){i({title:"Erro ao gerar QR Code",description:"N\xe3o foi poss\xedvel gerar o QR Code.",variant:"destructive"})}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(eR,{children:[(0,t.jsx)(eT,{asChild:!0,children:(0,t.jsx)(m,{variant:"ghost",className:"h-8 w-8 p-0",children:(0,t.jsx)(eq.Z,{className:"h-4 w-4"})})}),(0,t.jsxs)(eO,{align:"end",children:[(0,t.jsxs)(eP,{onClick:()=>d(!0),children:[(0,t.jsx)(eD.Z,{className:"mr-2 h-4 w-4"}),"Ver Detalhes"]}),(0,t.jsxs)(eP,{onClick:c,children:[(0,t.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),"Gerar QR Code"]}),(0,t.jsxs)(eP,{onClick:()=>o(!0),children:[(0,t.jsx)(eA.Z,{className:"mr-2 h-4 w-4"}),"Editar"]}),(0,t.jsxs)(eP,{onClick:()=>{let e=new Blob([JSON.stringify({...a,exportDate:new Date().toISOString()},null,2)],{type:"application/json"}),s=window.URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download="material-".concat(a.name.replace(/\s+/g,"-").toLowerCase(),".json"),t.click(),window.URL.revokeObjectURL(s),i({title:"Material exportado",description:"Dados do material foram exportados com sucesso!"})},children:[(0,t.jsx)(eF.Z,{className:"mr-2 h-4 w-4"}),"Exportar"]}),(0,t.jsxs)(eP,{onClick:()=>{window.confirm('Tem certeza que deseja excluir "'.concat(a.name,'"?'))&&(s(a.id),i({title:"Material exclu\xeddo",description:"Material foi removido com sucesso!",variant:"destructive"}))},className:"text-red-600",children:[(0,t.jsx)(eL.Z,{className:"mr-2 h-4 w-4"}),"Excluir"]})]})]}),(0,t.jsx)(_,{open:n,onOpenChange:o,children:(0,t.jsxs)(G,{className:"max-w-2xl",children:[(0,t.jsx)(J,{children:(0,t.jsx)($,{children:"Editar Material"})}),(0,t.jsx)(em,{material:a,onSuccess:()=>o(!1)})]})}),(0,t.jsx)(_,{open:l,onOpenChange:d,children:(0,t.jsxs)(G,{className:"max-w-2xl",children:[(0,t.jsx)(J,{children:(0,t.jsx)($,{children:"Detalhes do Material"})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold",children:"Nome"}),(0,t.jsx)("p",{children:a.name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold",children:"Categoria"}),(0,t.jsx)("p",{children:a.category})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold",children:"Fornecedor"}),(0,t.jsx)("p",{children:a.supplier})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold",children:"Quantidade"}),(0,t.jsxs)("p",{children:[a.quantity," ",a.unit]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold",children:"Pre\xe7o Unit\xe1rio"}),(0,t.jsxs)("p",{children:["R$ ",a.price.toFixed(2)]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold",children:"Valor Total"}),(0,t.jsxs)("p",{children:["R$ ",(a.price*a.quantity).toFixed(2)]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold",children:"Estoque M\xednimo"}),(0,t.jsxs)("p",{children:[a.minStock," ",a.unit]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold",children:"Status"}),(0,t.jsx)("p",{children:a.status})]})]}),a.notes&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold",children:"Observa\xe7\xf5es"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:a.notes})]})]})]})})]})}var eU=s(740),eM=s(3247);function eI(){let{materials:e}=M(),[a,s]=(0,r.useState)(""),[i,n]=(0,r.useState)(""),[o,l]=(0,r.useState)(""),[d,c]=(0,r.useState)(!1),u=[...new Set(e.map(e=>e.category))],x=e.filter(e=>{let s=e.name.toLowerCase().includes(a.toLowerCase())||e.supplier.toLowerCase().includes(a.toLowerCase()),t=!i||e.category===i,r=!o||e.status===o;return s&&t&&r}),h=e=>{switch(e){case"Em Estoque":default:return"default";case"Estoque Baixo":return"secondary";case"Sem Estoque":return"destructive"}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-start sm:items-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Materiais"}),(0,t.jsxs)(_,{open:d,onOpenChange:c,children:[(0,t.jsx)(B,{asChild:!0,children:(0,t.jsxs)(m,{children:[(0,t.jsx)(U.Z,{className:"mr-2 h-4 w-4"}),"Adicionar Material"]})}),(0,t.jsxs)(G,{className:"max-w-2xl",children:[(0,t.jsx)(J,{children:(0,t.jsx)($,{children:"Adicionar Novo Material"})}),(0,t.jsx)(em,{onSuccess:()=>c(!1)})]})]})]}),(0,t.jsxs)(O,{children:[(0,t.jsx)(P,{children:(0,t.jsxs)(q,{className:"flex items-center gap-2",children:[(0,t.jsx)(eU.Z,{className:"h-4 w-4"}),"Filtros"]})}),(0,t.jsx)(A,{children:(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(eM.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(X,{placeholder:"Buscar por nome ou fornecedor...",value:a,onChange:e=>s(e.target.value),className:"pl-10"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)(L,{variant:""===i?"default":"outline",className:"cursor-pointer",onClick:()=>n(""),children:"Todas Categorias"}),u.map(e=>(0,t.jsx)(L,{variant:i===e?"default":"outline",className:"cursor-pointer",onClick:()=>n(e),children:e},e))]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)(L,{variant:""===o?"default":"outline",className:"cursor-pointer",onClick:()=>l(""),children:"Todos Status"}),["Em Estoque","Estoque Baixo","Sem Estoque"].map(e=>(0,t.jsx)(L,{variant:o===e?"default":"outline",className:"cursor-pointer",onClick:()=>l(e),children:e},e))]})]})})]}),(0,t.jsx)(O,{children:(0,t.jsxs)(A,{className:"p-0",children:[(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(ev,{children:[(0,t.jsx)(eg,{children:(0,t.jsxs)(ey,{children:[(0,t.jsx)(eb,{children:"Nome"}),(0,t.jsx)(eb,{children:"Categoria"}),(0,t.jsx)(eb,{children:"Fornecedor"}),(0,t.jsx)(eb,{children:"Quantidade"}),(0,t.jsx)(eb,{children:"Pre\xe7o"}),(0,t.jsx)(eb,{children:"Status"}),(0,t.jsx)(eb,{className:"text-right",children:"A\xe7\xf5es"})]})}),(0,t.jsx)(eN,{children:x.map(e=>(0,t.jsxs)(ey,{children:[(0,t.jsx)(ew,{className:"font-medium",children:e.name}),(0,t.jsx)(ew,{children:e.category}),(0,t.jsx)(ew,{children:e.supplier}),(0,t.jsxs)(ew,{children:[e.quantity," ",e.unit]}),(0,t.jsxs)(ew,{children:["R$ ",e.price.toFixed(2)]}),(0,t.jsx)(ew,{children:(0,t.jsx)(L,{variant:h(e.status),children:e.status})}),(0,t.jsx)(ew,{className:"text-right",children:(0,t.jsx)(ez,{material:e})})]},e.id))})]})}),0===x.length&&(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Nenhum material encontrado"})]})})]})}var e_=s(3581),eB=s(7689),eV=s(791);function eQ(){var e;let[a,s]=(0,r.useState)(""),[i,n]=(0,r.useState)(!1),[o,l]=(0,r.useState)(null),[d,c]=(0,r.useState)({type:"adicionar",quantity:""}),u=(0,r.useRef)(null),x=(0,r.useRef)(null),h=(0,r.useRef)(null),{materials:p}=M(),{toast:j}=ec();(0,r.useEffect)(()=>()=>{if(u.current){u.current.stop().catch(()=>{});try{u.current.clear()}catch(e){}}},[]);let f=async()=>{let e=await eV.t2.getCameras().then(e=>{var a;return null===(a=e[0])||void 0===a?void 0:a.id});if(!e){j({title:"Erro",description:"Nenhuma c\xe2mera foi detectada no dispositivo.",variant:"destructive"});return}n(!0);let a=new eV.t2("qr-reader");u.current=a,a.start(e,{fps:10,qrbox:250},async e=>{await a.stop(),await a.clear(),u.current=null,n(!1),s(""),v(e)},()=>{}).catch(e=>{j({title:"Erro ao iniciar c\xe2mera",description:String(e),variant:"destructive"}),n(!1)})},v=e=>{let a=p.find(a=>a.id===e);s(e),l(a),j({title:a?"Material encontrado":"Material n\xe3o encontrado",description:a?'Material "'.concat(a.name,'" foi identificado.'):"O c\xf3digo QR n\xe3o corresponde a nenhum material cadastrado.",variant:a?"default":"destructive"})},g=e=>{(""===e||/^[0-9]*[.,]?[0-9]*$/.test(e))&&c(a=>({...a,quantity:e}))},N=async()=>{if(!o)return;let e=parseFloat(d.quantity.toString());if(isNaN(e)||e<=0){j({title:"Erro",description:"Quantidade deve ser um n\xfamero positivo maior que zero.",variant:"destructive"});return}try{let a=o.quantity,t="adicionar"===d.type?a+e:Math.max(0,a-e),{addMovement:r,currentProjectId:i,currentUserId:m}=M.getState();if(!i||!m){j({title:"Erro",description:"Projeto ou usu\xe1rio n\xe3o selecionado. Fa\xe7a login novamente.",variant:"destructive"});return}await r({type:"adicionar"===d.type?"entrada":"sa\xedda",materialId:o.id,materialName:o.name,materialCategory:o.category,quantity:e,location:"Dep\xf3sito Central",justification:"Ajuste via QR Scanner"},i,m),j({title:"Estoque atualizado",description:"Novo estoque: ".concat(t," ").concat(o.unit)}),l(null),s(""),n(!1),c(e=>({...e,quantity:""}))}catch(e){console.error("Erro ao atualizar estoque:",e),j({title:"Erro",description:"N\xe3o foi poss\xedvel atualizar o estoque. Tente novamente.",variant:"destructive"})}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Scanner QR"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)(O,{children:[(0,t.jsx)(P,{children:(0,t.jsxs)(q,{className:"flex items-center gap-2",children:[(0,t.jsx)(e_.Z,{className:"h-5 w-5"}),"Escanear com C\xe2mera"]})}),(0,t.jsxs)(A,{children:[!i&&!a&&(0,t.jsx)(m,{onClick:f,className:"w-full",children:"Iniciar Escaneamento"}),i&&!a&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m,{variant:"destructive",onClick:()=>{var e;null===(e=u.current)||void 0===e||e.stop().then(()=>{var e;null===(e=u.current)||void 0===e||e.clear(),n(!1)}).catch(e=>{j({title:"Erro ao parar escaneamento",description:String(e),variant:"destructive"})})},className:"w-full",children:"Parar Escaneamento"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"Escaneando... aponte a c\xe2mera para o QR code"})]}),(0,t.jsx)("div",{id:"qr-reader",ref:x,className:"mt-4"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"Aponte a c\xe2mera para o c\xf3digo QR do material"})]})]}),(0,t.jsxs)(O,{children:[(0,t.jsx)(P,{children:(0,t.jsxs)(q,{className:"flex items-center gap-2",children:[(0,t.jsx)(eB.Z,{className:"h-5 w-5"}),"Upload de Imagem"]})}),(0,t.jsxs)(A,{children:[(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var a;let t=null===(a=e.target.files)||void 0===a?void 0:a[0];t&&new eV.t2("image-scan").scanFile(t,!0).then(e=>{v(e),setTimeout(()=>s(""),500)}).catch(()=>{j({title:"QR Code n\xe3o detectado",description:"N\xe3o foi poss\xedvel ler um c\xf3digo QR da imagem.",variant:"destructive"})})},ref:h,className:"hidden"}),(0,t.jsx)(m,{onClick:()=>{var e;return null===(e=h.current)||void 0===e?void 0:e.click()},variant:"outline",className:"w-full",children:"Selecionar Imagem"}),(0,t.jsx)("div",{id:"image-scan",className:"hidden"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"Fa\xe7a upload de uma imagem contendo o c\xf3digo QR"})]})]})]}),(0,t.jsx)(_,{open:!!o,onOpenChange:e=>{e||(l(null),s(""),c(e=>({...e,quantity:""})))},children:(0,t.jsxs)(G,{children:[(0,t.jsx)(J,{children:(0,t.jsx)($,{children:"Atualizar Estoque"})}),o&&(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(ee,{htmlFor:"updateType",children:"Tipo de atualiza\xe7\xe3o"}),(0,t.jsxs)("select",{id:"updateType",value:d.type,onChange:e=>c(a=>({...a,type:e.target.value})),className:"w-full p-2 border rounded-md",children:[(0,t.jsx)("option",{value:"adicionar",children:"Adicionar"}),(0,t.jsx)("option",{value:"remover",children:"Remover"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(ee,{htmlFor:"stockQuantity",children:"Quantidade *"}),(0,t.jsx)(X,{id:"stockQuantity",type:"text",value:""===(e=d.quantity)||0===e?"":e.toString(),onChange:e=>g(e.target.value),placeholder:"0",className:"font-mono"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Digite apenas n\xfameros. Use v\xedrgula ou ponto para decimais"})]})]})}),(0,t.jsx)(Y,{children:(0,t.jsx)(m,{onClick:N,className:"w-full",disabled:!d.quantity||0>=parseFloat(d.quantity.toString()),children:"Atualizar Estoque"})})]})})]})}var eG=s(271);let eJ=eG.fC,eY=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(eG.aV,{ref:a,className:o("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...r})});eY.displayName=eG.aV.displayName;let e$=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(eG.xz,{ref:a,className:o("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...r})});e$.displayName=eG.xz.displayName;let eH=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(eG.VY,{ref:a,className:o("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r})});eH.displayName=eG.VY.displayName;var eX=s(9345);function eW(){let{movements:e}=M(),{toast:a}=ec(),[s,i]=(0,r.useState)(""),[n,o]=(0,r.useState)(""),l=e.filter(e=>{let a=e.materialName.toLowerCase().includes(s.toLowerCase())||e.location.toLowerCase().includes(s.toLowerCase())||e.justification.toLowerCase().includes(s.toLowerCase()),t=!n||new Date(e.date).toISOString().split("T")[0]===n;return a&&t}),d=e.reduce((e,a)=>{let s=a.materialName;return e[s]||(e[s]={entrada:0,saida:0,total:0}),"entrada"===a.actionType?e[s].entrada+=a.quantity:e[s].saida+=a.quantity,e[s].total=e[s].entrada-e[s].saida,e},{});return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-start sm:items-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Movimenta\xe7\xf5es"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(m,{onClick:()=>{let e=new Blob([["Data,Material,Categoria,Tipo,Quantidade,Local,Justificativa",...l.map(e=>[new Date(e.date).toLocaleDateString("pt-BR"),e.materialName,e.materialCategory,"entrada"===e.actionType?"Entrada":"Sa\xedda",e.quantity,e.location,'"'.concat(e.justification,'"')].join(","))].join("\n")],{type:"text/csv"}),s=window.URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download="movimentacoes_".concat(new Date().toISOString().split("T")[0],".csv"),t.click(),window.URL.revokeObjectURL(s),a({title:"Exporta\xe7\xe3o conclu\xedda",description:"Arquivo CSV baixado com sucesso!"})},variant:"outline",size:"sm",children:[(0,t.jsx)(eF.Z,{className:"mr-2 h-4 w-4"}),"CSV"]}),(0,t.jsxs)(m,{onClick:()=>{let e=new Blob([l.map(e=>"Data: ".concat(new Date(e.date).toLocaleDateString("pt-BR"),"\n")+"Material: ".concat(e.materialName,"\n")+"Categoria: ".concat(e.materialCategory,"\n")+"Tipo: ".concat("entrada"===e.actionType?"Entrada":"Sa\xedda","\n")+"Quantidade: ".concat(e.quantity,"\n")+"Local: ".concat(e.location,"\n")+"Justificativa: ".concat(e.justification,"\n")+"".concat("=".repeat(50),"\n")).join("\n")],{type:"text/plain"}),s=window.URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download="relatorio_movimentacoes_".concat(new Date().toISOString().split("T")[0],".txt"),t.click(),window.URL.revokeObjectURL(s),a({title:"Relat\xf3rio exportado",description:"Arquivo TXT baixado com sucesso!"})},variant:"outline",size:"sm",children:[(0,t.jsx)(z.Z,{className:"mr-2 h-4 w-4"}),"TXT"]}),(0,t.jsxs)(m,{onClick:()=>{a({title:"Email enviado",description:"Relat\xf3rio enviado para seu email com sucesso! (simulado)"})},variant:"outline",size:"sm",children:[(0,t.jsx)(eX.Z,{className:"mr-2 h-4 w-4"}),"Email"]})]})]}),(0,t.jsxs)(eJ,{defaultValue:"history",className:"space-y-4",children:[(0,t.jsxs)(eY,{children:[(0,t.jsx)(e$,{value:"history",children:"Hist\xf3rico"}),(0,t.jsx)(e$,{value:"reports",children:"Relat\xf3rios"})]}),(0,t.jsxs)(eH,{value:"history",className:"space-y-4",children:[(0,t.jsxs)(O,{children:[(0,t.jsx)(P,{children:(0,t.jsx)(q,{children:"Filtros"})}),(0,t.jsx)(A,{children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,t.jsx)(X,{placeholder:"Buscar por material, local ou justificativa...",value:s,onChange:e=>i(e.target.value),className:"flex-1"}),(0,t.jsx)(X,{type:"date",value:n,onChange:e=>o(e.target.value),className:"w-full md:w-auto"})]})})]}),(0,t.jsx)(O,{children:(0,t.jsxs)(A,{className:"p-0",children:[(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(ev,{children:[(0,t.jsx)(eg,{children:(0,t.jsxs)(ey,{children:[(0,t.jsx)(eb,{children:"Data"}),(0,t.jsx)(eb,{children:"Material"}),(0,t.jsx)(eb,{children:"Categoria"}),(0,t.jsx)(eb,{children:"Tipo"}),(0,t.jsx)(eb,{children:"Quantidade"}),(0,t.jsx)(eb,{children:"Local"}),(0,t.jsx)(eb,{children:"Justificativa"})]})}),(0,t.jsx)(eN,{children:l.map(e=>(0,t.jsxs)(ey,{children:[(0,t.jsx)(ew,{children:new Date(e.date).toLocaleDateString("pt-BR")}),(0,t.jsx)(ew,{className:"font-medium",children:e.materialName}),(0,t.jsx)(ew,{children:e.materialCategory}),(0,t.jsx)(ew,{children:(0,t.jsx)(L,{variant:"entrada"===e.actionType?"default":"secondary",children:"entrada"===e.actionType?"Entrada":"Sa\xedda"})}),(0,t.jsx)(ew,{children:e.quantity}),(0,t.jsx)(ew,{children:e.location}),(0,t.jsx)(ew,{className:"max-w-xs truncate",children:e.justification})]},e.id))})]})}),0===l.length&&(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Nenhuma movimenta\xe7\xe3o encontrada"})]})})]}),(0,t.jsx)(eH,{value:"reports",className:"space-y-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(O,{children:[(0,t.jsx)(P,{children:(0,t.jsx)(q,{children:"Resumo por Material"})}),(0,t.jsx)(A,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[Object.entries(d).map(e=>{let[a,s]=e;return(0,t.jsxs)("div",{className:"flex justify-between items-center p-3 border rounded",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:a}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Entrada: ",s.entrada," | Sa\xedda: ",s.saida]})]}),(0,t.jsxs)(L,{variant:s.total>=0?"default":"destructive",children:[s.total>=0?"+":"",s.total]})]},a)}),0===Object.keys(d).length&&(0,t.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"Nenhuma movimenta\xe7\xe3o registrada"})]})})]}),(0,t.jsxs)(O,{children:[(0,t.jsx)(P,{children:(0,t.jsx)(q,{children:"Estat\xedsticas"})}),(0,t.jsx)(A,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Total de Movimenta\xe7\xf5es:"}),(0,t.jsx)("span",{className:"font-bold",children:e.length})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Entradas:"}),(0,t.jsx)("span",{className:"font-bold text-green-600",children:e.filter(e=>"entrada"===e.actionType).length})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Sa\xeddas:"}),(0,t.jsx)("span",{className:"font-bold text-red-600",children:e.filter(e=>"sa\xedda"===e.actionType).length})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Materiais \xdanicos:"}),(0,t.jsx)("span",{className:"font-bold",children:new Set(e.map(e=>e.materialId)).size})]})]})})]})]})})]})]})}var eK=s(2207),e0=s(3229),e2=s(8906),e4=s(6337),e1=s(7769);function e5(e){let{user:a,onUpdateProfile:s}=e,{toast:i}=ec(),[n,o]=(0,r.useState)(!1),[l,d]=(0,r.useState)(!1),[c,u]=(0,r.useState)(!1),[x,h]=(0,r.useState)({name:"",email:""}),[p,j]=(0,r.useState)({currentPassword:"",newPassword:"",confirmPassword:""}),[f,g]=(0,r.useState)({current:!1,new:!1,confirm:!1});(0,r.useEffect)(()=>{a&&h({name:a.name||"",email:a.email||""})},[a]);let N=(e,a)=>{h(s=>({...s,[e]:a}))},y=(e,a)=>{j(s=>({...s,[e]:a}))},b=e=>{g(a=>({...a,[e]:!a[e]}))},w=async()=>{if(a){d(!0);try{if(!x.name.trim()||!x.email.trim()){i({title:"Erro de valida\xe7\xe3o",description:"Nome e email s\xe3o obrigat\xf3rios.",variant:"destructive"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x.email)){i({title:"Email inv\xe1lido",description:"Digite um email v\xe1lido.",variant:"destructive"});return}let e=await fetch("/api/auth/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a.id,name:x.name.trim(),email:x.email.trim()})});if(e.ok){let a=await e.json();s(a),o(!1),i({title:"Perfil atualizado",description:"Suas informa\xe7\xf5es foram salvas com sucesso!"})}else{let a=await e.json();throw Error(a.message||"Erro ao atualizar perfil")}}catch(e){i({title:"Erro ao atualizar",description:e instanceof Error?e.message:"N\xe3o foi poss\xedvel atualizar o perfil.",variant:"destructive"})}finally{d(!1)}}},S=async()=>{if(a){if(!p.currentPassword||!p.newPassword||!p.confirmPassword){i({title:"Erro de valida\xe7\xe3o",description:"Todos os campos s\xe3o obrigat\xf3rios.",variant:"destructive"});return}if(p.newPassword!==p.confirmPassword){i({title:"Senhas n\xe3o coincidem",description:"A nova senha e confirma\xe7\xe3o devem ser iguais.",variant:"destructive"});return}if(p.newPassword.length<6){i({title:"Senha muito curta",description:"A nova senha deve ter pelo menos 6 caracteres.",variant:"destructive"});return}d(!0);try{let e=await fetch("/api/auth/change-password",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a.id,currentPassword:p.currentPassword,newPassword:p.newPassword})});if(e.ok)i({title:"Senha alterada",description:"Sua senha foi alterada com sucesso!"}),j({currentPassword:"",newPassword:"",confirmPassword:""}),u(!1);else{let a=await e.json();throw Error(a.message||"Erro ao alterar senha")}}catch(e){i({title:"Erro ao alterar senha",description:e instanceof Error?e.message:"N\xe3o foi poss\xedvel alterar a senha.",variant:"destructive"})}finally{d(!1)}}};return a?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Perfil do Usu\xe1rio"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Gerencie suas informa\xe7\xf5es pessoais e configura\xe7\xf5es da conta"})]}),!n&&(0,t.jsxs)(m,{onClick:()=>o(!0),children:[(0,t.jsx)(eK.Z,{className:"mr-2 h-4 w-4"}),"Editar Perfil"]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(O,{children:[(0,t.jsx)(P,{children:(0,t.jsxs)(q,{className:"flex items-center gap-2",children:[(0,t.jsx)(v.Z,{className:"h-5 w-5"}),"Informa\xe7\xf5es Gerais"]})}),(0,t.jsx)(A,{className:"space-y-4",children:n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{htmlFor:"name",children:"Nome Completo *"}),(0,t.jsx)(X,{id:"name",value:x.name,onChange:e=>N("name",e.target.value),placeholder:"Seu nome completo",disabled:l})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{htmlFor:"email",children:"E-mail *"}),(0,t.jsx)(X,{id:"email",type:"email",value:x.email,onChange:e=>N("email",e.target.value),placeholder:"seu@email.com",disabled:l})]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,t.jsxs)(m,{onClick:w,disabled:l,children:[(0,t.jsx)(e0.Z,{className:"mr-2 h-4 w-4"}),l?"Salvando...":"Salvar"]}),(0,t.jsx)(m,{variant:"outline",onClick:()=>{a&&h({name:a.name||"",email:a.email||""}),o(!1)},disabled:l,children:"Cancelar"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{className:"text-sm font-medium text-muted-foreground",children:"Nome"}),(0,t.jsx)("p",{className:"text-lg font-medium",children:a.name||"N\xe3o informado"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{className:"text-sm font-medium text-muted-foreground",children:"E-mail"}),(0,t.jsx)("p",{className:"text-lg font-medium",children:a.email})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{className:"text-sm font-medium text-muted-foreground",children:"Fun\xe7\xe3o"}),(0,t.jsx)("p",{className:"text-lg font-medium",children:a.role||"N\xe3o informado"})]})]})})]}),(0,t.jsxs)(O,{children:[(0,t.jsx)(P,{children:(0,t.jsxs)(q,{className:"flex items-center gap-2",children:[(0,t.jsx)(e2.Z,{className:"h-5 w-5"}),"Detalhes da Conta"]})}),(0,t.jsxs)(A,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{className:"text-sm font-medium text-muted-foreground",children:"ID do Usu\xe1rio"}),(0,t.jsx)("p",{className:"text-sm font-mono bg-muted p-2 rounded",children:a.id})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{className:"text-sm font-medium text-muted-foreground",children:"Status da Conta"}),(0,t.jsx)(L,{variant:"default",className:"w-fit",children:"Ativo"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{className:"text-sm font-medium text-muted-foreground",children:"Data de Cria\xe7\xe3o"}),(0,t.jsx)("p",{className:"text-sm",children:new Date(a.createdAt).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),a.lastLogin&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{className:"text-sm font-medium text-muted-foreground",children:"\xdaltimo Login"}),(0,t.jsx)("p",{className:"text-sm",children:new Date(a.lastLogin).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})]})]}),(0,t.jsxs)(O,{children:[(0,t.jsx)(P,{children:(0,t.jsxs)(q,{className:"flex items-center gap-2",children:[(0,t.jsx)(e4.Z,{className:"h-5 w-5"}),"Seguran\xe7a da Conta"]})}),(0,t.jsx)(A,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"font-medium",children:"Alterar Senha"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Atualize sua senha para manter a conta segura"})]}),(0,t.jsx)(m,{variant:"outline",onClick:()=>u(!c),children:c?"Cancelar":"Alterar Senha"})]}),c&&(0,t.jsxs)("div",{className:"p-4 border rounded-lg space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{htmlFor:"currentPassword",children:"Senha Atual *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(X,{id:"currentPassword",type:f.current?"text":"password",value:p.currentPassword,onChange:e=>y("currentPassword",e.target.value),placeholder:"Digite sua senha atual",disabled:l}),(0,t.jsx)(m,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>b("current"),children:f.current?(0,t.jsx)(e1.Z,{className:"h-4 w-4"}):(0,t.jsx)(eD.Z,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{htmlFor:"newPassword",children:"Nova Senha *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(X,{id:"newPassword",type:f.new?"text":"password",value:p.newPassword,onChange:e=>y("newPassword",e.target.value),placeholder:"Digite a nova senha",disabled:l}),(0,t.jsx)(m,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>b("new"),children:f.new?(0,t.jsx)(e1.Z,{className:"h-4 w-4"}):(0,t.jsx)(eD.Z,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{htmlFor:"confirmPassword",children:"Confirmar Nova Senha *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(X,{id:"confirmPassword",type:f.confirm?"text":"password",value:p.confirmPassword,onChange:e=>y("confirmPassword",e.target.value),placeholder:"Confirme a nova senha",disabled:l}),(0,t.jsx)(m,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>b("confirm"),children:f.confirm?(0,t.jsx)(e1.Z,{className:"h-4 w-4"}):(0,t.jsx)(eD.Z,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,t.jsxs)(m,{onClick:S,disabled:l,children:[(0,t.jsx)(e4.Z,{className:"mr-2 h-4 w-4"}),l?"Alterando...":"Alterar Senha"]}),(0,t.jsx)(m,{variant:"outline",onClick:()=>{j({currentPassword:"",newPassword:"",confirmPassword:""}),u(!1)},disabled:l,children:"Cancelar"})]})]})]})})]})]}):(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(v.Z,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Usu\xe1rio n\xe3o encontrado"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Fa\xe7a login para acessar seu perfil."})]})})}function e6(e){let{children:a,...s}=e;return(0,t.jsx)(E.f,{...s,attribute:"class",defaultTheme:"system",enableSystem:!0,disableTransitionOnChange:!0,children:a})}var e3=s(1915);let e8=e3.zt,e9=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(e3.l_,{ref:a,className:o("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...r})});e9.displayName=e3.l_.displayName;let e7=(0,d.j)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),ae=r.forwardRef((e,a)=>{let{className:s,variant:r,...i}=e;return(0,t.jsx)(e3.fC,{ref:a,className:o(e7({variant:r}),s),...i})});ae.displayName=e3.fC.displayName,r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(e3.aU,{ref:a,className:o("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...r})}).displayName=e3.aU.displayName;let aa=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(e3.x8,{ref:a,className:o("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...r,children:(0,t.jsx)(f.Z,{className:"h-4 w-4"})})});aa.displayName=e3.x8.displayName;let as=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(e3.Dx,{ref:a,className:o("text-sm font-semibold",s),...r})});as.displayName=e3.Dx.displayName;let at=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(e3.dk,{ref:a,className:o("text-sm opacity-90",s),...r})});function ar(){let{toasts:e}=ec();return(0,t.jsxs)(e8,{children:[e.map(function(e){let{id:a,title:s,description:r,action:i,...n}=e;return(0,t.jsxs)(ae,{...n,children:[(0,t.jsxs)("div",{className:"grid gap-1",children:[s&&(0,t.jsx)(as,{children:s}),r&&(0,t.jsx)(at,{children:r})]}),i,(0,t.jsx)(aa,{})]},a)}),(0,t.jsx)(e9,{})]})}at.displayName=e3.dk.displayName;var ai=s(1817);function an(e){let{onSignup:a,goToLogin:s}=e,[i,n]=(0,r.useState)(""),[o,l]=(0,r.useState)(""),[d,c]=(0,r.useState)(""),[u,x]=(0,r.useState)(""),[h,p]=(0,r.useState)(null),[j,f]=(0,r.useState)(!1),v=async e=>{e.preventDefault(),p(null),f(!0);try{if(!i.trim()||!o.trim()||!d.trim()){p("Por favor, preencha todos os campos obrigat\xf3rios."),f(!1);return}if(d!==u){p("As senhas n\xe3o coincidem."),f(!1);return}if(d.length<6){p("A senha deve ter pelo menos 6 caracteres."),f(!1);return}let e=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i.trim(),email:o.trim(),password:d})});if(e.ok){let s=await e.json();s&&s.id&&s.email?a(s):p("Resposta inv\xe1lida do servidor.")}else{let a=await e.json();p(a.message||"Erro ao criar conta.")}}catch(e){p("N\xe3o foi poss\xedvel conectar ao servidor. Tente novamente.")}finally{f(!1)}};return(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen p-4",children:(0,t.jsxs)(O,{className:"w-full max-w-md",children:[(0,t.jsxs)(P,{className:"space-y-1",children:[(0,t.jsx)(q,{className:"text-2xl text-center",children:"Criar Conta"}),(0,t.jsx)(D,{className:"text-center",children:"Preencha os dados para criar sua conta"})]}),(0,t.jsx)(A,{children:(0,t.jsxs)("form",{onSubmit:v,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{htmlFor:"name",children:"Nome *"}),(0,t.jsx)(X,{id:"name",type:"text",value:i,onChange:e=>n(e.target.value),placeholder:"Seu nome completo",required:!0,disabled:j})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{htmlFor:"email",children:"Email *"}),(0,t.jsx)(X,{id:"email",type:"email",value:o,onChange:e=>l(e.target.value),placeholder:"seu@email.com",required:!0,disabled:j})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{htmlFor:"password",children:"Senha *"}),(0,t.jsx)(X,{id:"password",type:"password",value:d,onChange:e=>c(e.target.value),placeholder:"M\xednimo 6 caracteres",required:!0,disabled:j,minLength:6})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{htmlFor:"confirm-password",children:"Confirmar Senha *"}),(0,t.jsx)(X,{id:"confirm-password",type:"password",value:u,onChange:e=>x(e.target.value),placeholder:"Confirme sua senha",required:!0,disabled:j,minLength:6})]}),h&&(0,t.jsx)("div",{className:"text-sm text-destructive bg-destructive/10 p-3 rounded-md",children:h}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(m,{type:"submit",className:"w-full",disabled:j,children:j?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ai.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Criando conta..."]}):"Criar Conta"}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)(m,{type:"button",variant:"link",onClick:s,disabled:j,className:"text-sm",children:"J\xe1 tem uma conta? Fa\xe7a login"})})]})]})})]})})}function ao(e){let{user:a,onSelectProject:s}=e,[i,n]=(0,r.useState)([]),[o,l]=(0,r.useState)(null),[d,c]=(0,r.useState)(!0),[u,x]=(0,r.useState)(null),[h,p]=(0,r.useState)(!1),[j,f]=(0,r.useState)(!1),[v,g]=(0,r.useState)(""),[N,y]=(0,r.useState)("");(0,r.useEffect)(()=>{(async()=>{if(!(null==a?void 0:a.id)){c(!1);return}try{c(!0),x(null);let e=await fetch("/api/auth/projects?userId=".concat(a.id));if(e.ok){let a=await e.json();n(a),a.length>0&&l(a[0].id)}else{let a=await e.json();x(a.message||"Erro ao carregar projetos.")}}catch(e){x("Erro ao conectar com o servidor.")}finally{c(!1)}})()},[a]);let b=async()=>{if((null==a?void 0:a.id)&&v.trim())try{p(!0),x(null);let e=await fetch("/api/auth/projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:v.trim(),description:N.trim()||null,userId:a.id})});if(e.ok){let a=await e.json();n(e=>[...e,a]),l(a.id),g(""),y(""),f(!1),setTimeout(()=>{a.id&&console.log("Projeto criado e selecionado:",a.id)},0)}else{let a=await e.json();x(a.message||"Erro ao criar projeto.")}}catch(e){x("Erro ao conectar com o servidor.")}finally{p(!1)}};return d?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(ai.Z,{className:"h-6 w-6 animate-spin"}),(0,t.jsx)("span",{children:"Carregando projetos..."})]})}):u?(0,t.jsxs)(O,{className:"max-w-lg mx-auto",children:[(0,t.jsx)(P,{children:(0,t.jsx)(q,{className:"text-destructive",children:"Erro"})}),(0,t.jsxs)(A,{children:[(0,t.jsx)("p",{className:"text-destructive mb-4",children:u}),(0,t.jsx)(m,{onClick:()=>window.location.reload(),children:"Tentar Novamente"})]})]}):(0,t.jsx)("div",{className:"max-w-2xl mx-auto space-y-6",children:(0,t.jsxs)(O,{children:[(0,t.jsxs)(P,{children:[(0,t.jsxs)(q,{children:["Bem-vindo",(null==a?void 0:a.name)?", ".concat(a.name):""]}),(0,t.jsx)(D,{children:"Selecione um projeto para continuar ou crie um novo"})]}),(0,t.jsxs)(A,{className:"space-y-4",children:[i.length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(ee,{className:"text-sm font-medium",children:"Selecione um projeto:"}),(0,t.jsx)("div",{className:"grid gap-3",children:i.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-3 p-3 rounded-lg border cursor-pointer transition-colors ".concat(o===e.id?"border-primary bg-primary/5":"border-border hover:border-primary/50"),onClick:()=>l(e.id),children:[(0,t.jsx)("input",{type:"radio",name:"project",checked:o===e.id,onChange:()=>l(e.id),className:"text-primary"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),e.description&&(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:e.description})]})]},e.id))})]}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)(m,{onClick:()=>{o?(console.log("Continuando com projeto selecionado:",o),s(o)):console.log("Nenhum projeto selecionado")},disabled:!o,className:"min-w-[100px]",children:o?"Continuar":"Selecione um projeto"})})]}):(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"text-muted-foreground mb-4",children:"Voc\xea ainda n\xe3o tem projetos cadastrados."}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-6",children:"Crie seu primeiro projeto para come\xe7ar a usar o sistema."})]}),(0,t.jsx)("div",{className:"border-t pt-4",children:(0,t.jsxs)(_,{open:j,onOpenChange:f,children:[(0,t.jsx)(B,{asChild:!0,children:(0,t.jsxs)(m,{variant:"outline",className:"w-full",children:[(0,t.jsx)(U.Z,{className:"h-4 w-4 mr-2"}),"Novo Projeto"]})}),(0,t.jsxs)(G,{children:[(0,t.jsxs)(J,{children:[(0,t.jsx)($,{children:"Criar Novo Projeto"}),(0,t.jsx)(H,{children:"Preencha as informa\xe7\xf5es do novo projeto"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(ee,{htmlFor:"project-name",children:"Nome do Projeto *"}),(0,t.jsx)(X,{id:"project-name",value:v,onChange:e=>g(e.target.value),placeholder:"Digite o nome do projeto",disabled:h})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(ee,{htmlFor:"project-description",children:"Descri\xe7\xe3o (opcional)"}),(0,t.jsx)(ea,{id:"project-description",value:N,onChange:e=>y(e.target.value),placeholder:"Descreva o projeto",disabled:h,rows:3})]})]}),(0,t.jsxs)(Y,{children:[(0,t.jsx)(m,{variant:"outline",onClick:()=>f(!1),disabled:h,children:"Cancelar"}),(0,t.jsx)(m,{onClick:b,disabled:!v.trim()||h,children:h?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ai.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Criando..."]}):"Criar Projeto"})]})]})]})})]})]})})}function al(e){let{onLogin:a,goToSignup:s}=e,[i,n]=(0,r.useState)(""),[o,l]=(0,r.useState)(""),[d,c]=(0,r.useState)(null),[u,x]=(0,r.useState)(!1),h=async e=>{e.preventDefault(),c(null),x(!0);try{if(!i.trim()||!o.trim()){c("Por favor, preencha todos os campos."),x(!1);return}let e=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i.trim(),password:o})});if(e.ok){let s=await e.json();s&&s.id&&s.email?a(s):c("Resposta inv\xe1lida do servidor.")}else{let a=await e.json();c(a.message||"Email ou senha incorretos.")}}catch(e){c("N\xe3o foi poss\xedvel conectar ao servidor. Tente novamente.")}finally{x(!1)}};return(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen p-4",children:(0,t.jsxs)(O,{className:"w-full max-w-md",children:[(0,t.jsxs)(P,{className:"space-y-1",children:[(0,t.jsx)(q,{className:"text-2xl text-center",children:"Entrar"}),(0,t.jsx)(D,{className:"text-center",children:"Digite suas credenciais para acessar sua conta"})]}),(0,t.jsx)(A,{children:(0,t.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{htmlFor:"email",children:"Email"}),(0,t.jsx)(X,{id:"email",type:"email",value:i,onChange:e=>n(e.target.value),placeholder:"seu@email.com",required:!0,disabled:u})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(ee,{htmlFor:"password",children:"Senha"}),(0,t.jsx)(X,{id:"password",type:"password",value:o,onChange:e=>l(e.target.value),placeholder:"Digite sua senha",required:!0,disabled:u})]}),d&&(0,t.jsx)("div",{className:"text-sm text-destructive bg-destructive/10 p-3 rounded-md",children:d}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(m,{type:"submit",className:"w-full",disabled:u,children:u?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ai.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Entrando..."]}):"Entrar"}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)(m,{type:"button",variant:"link",onClick:s,disabled:u,className:"text-sm",children:"N\xe3o tem uma conta? Cadastre-se"})})]})]})})]})})}var ad=s(3402),ac=s(875),am=s(2135);let au=ad.fC;ad.ZA;let ax=ad.B4,ah=r.forwardRef((e,a)=>{let{className:s,children:r,...i}=e;return(0,t.jsxs)(ad.xz,{ref:a,className:o("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...i,children:[r,(0,t.jsx)(ad.JO,{asChild:!0,children:(0,t.jsx)(ac.Z,{className:"h-4 w-4 opacity-50"})})]})});ah.displayName=ad.xz.displayName;let ap=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(ad.u_,{ref:a,className:o("flex cursor-default items-center justify-center py-1",s),...r,children:(0,t.jsx)(am.Z,{className:"h-4 w-4"})})});ap.displayName=ad.u_.displayName;let aj=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(ad.$G,{ref:a,className:o("flex cursor-default items-center justify-center py-1",s),...r,children:(0,t.jsx)(ac.Z,{className:"h-4 w-4"})})});aj.displayName=ad.$G.displayName;let af=r.forwardRef((e,a)=>{let{className:s,children:r,position:i="popper",...n}=e;return(0,t.jsx)(ad.h_,{children:(0,t.jsxs)(ad.VY,{ref:a,className:o("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:i,...n,children:[(0,t.jsx)(ap,{}),(0,t.jsx)(ad.l_,{className:o("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,t.jsx)(aj,{})]})})});af.displayName=ad.VY.displayName,r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(ad.__,{ref:a,className:o("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r})}).displayName=ad.__.displayName;let av=r.forwardRef((e,a)=>{let{className:s,children:r,...i}=e;return(0,t.jsxs)(ad.ck,{ref:a,className:o("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...i,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(ad.wU,{children:(0,t.jsx)(ek.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(ad.eT,{children:r})]})});av.displayName=ad.ck.displayName,r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(ad.Z0,{ref:a,className:o("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=ad.Z0.displayName;var ag=s(721);let aN=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(ag.fC,{className:o("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...r,ref:a,children:(0,t.jsx)(ag.bU,{className:o("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});aN.displayName=ag.fC.displayName;var ay=s(7806);function ab(e){let{projectId:a,currentUserRole:s,currentUserId:i}=e,{toast:n}=ec(),[o,l]=(0,r.useState)([]),[d,c]=(0,r.useState)([]),[u,x]=(0,r.useState)(!0),[h,p]=(0,r.useState)(!1),[j,f]=(0,r.useState)({name:"",email:"",role:"COLABORADOR"}),[g,N]=(0,r.useState)(!1);(0,r.useEffect)(()=>{y(),b()},[a]);let y=async()=>{try{let e=await fetch("/api/projects/".concat(a,"/members"));if(e.ok){let a=await e.json();l(a)}}catch(e){console.error("Erro ao buscar membros:",e)}},b=async()=>{try{let e=await fetch("/api/projects/".concat(a,"/invites"));if(e.ok){let a=await e.json();c(a)}}catch(e){console.error("Erro ao buscar convites:",e)}finally{x(!1)}},w=async()=>{if(!j.name.trim()||!j.email.trim()){n({title:"Erro de valida\xe7\xe3o",description:"Nome e email s\xe3o obrigat\xf3rios.",variant:"destructive"});return}N(!0);try{let e=await fetch("/api/projects/".concat(a,"/invites"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...j,sentById:i})});if(e.ok)n({title:"Convite enviado",description:"O convite foi enviado com sucesso!"}),f({name:"",email:"",role:"COLABORADOR"}),p(!1),b();else{let a=await e.json();throw Error(a.message||"Erro ao enviar convite")}}catch(e){n({title:"Erro ao enviar convite",description:e instanceof Error?e.message:"N\xe3o foi poss\xedvel enviar o convite.",variant:"destructive"})}finally{N(!1)}},S=async(e,s)=>{let t="ATIVO"===s?"INATIVO":"ATIVO",r="ATIVO"===t?"ativar":"desativar";if(confirm("Tem certeza que deseja ".concat(r," este usu\xe1rio?")))try{let s=await fetch("/api/projects/".concat(a,"/members/").concat(e,"/status"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})});if(s.ok)n({title:"Status atualizado",description:"Usu\xe1rio ".concat(r," com sucesso!")}),y();else{let e=await s.json();throw Error(e.message||"Erro ao atualizar status")}}catch(e){n({title:"Erro ao atualizar status",description:e instanceof Error?e.message:"N\xe3o foi poss\xedvel atualizar o status.",variant:"destructive"})}},C=async(e,s)=>{if(confirm("Tem certeza que deseja remover o usu\xe1rio ".concat(s,"?")))try{let t=await fetch("/api/projects/".concat(a,"/members/").concat(e),{method:"DELETE"});if(t.ok)n({title:"Usu\xe1rio removido",description:"Usu\xe1rio ".concat(s," removido com sucesso!")}),y();else{let e=await t.json();throw Error(e.message||"Erro ao remover usu\xe1rio")}}catch(e){n({title:"Erro ao remover usu\xe1rio",description:e instanceof Error?e.message:"N\xe3o foi poss\xedvel remover o usu\xe1rio.",variant:"destructive"})}},k=e=>"GESTOR"===e?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",E=e=>{switch(e){case"ATIVO":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"INATIVO":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"PENDENTE":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}};return"GESTOR"!==s?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(e2.Z,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Acesso Negado"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Apenas gestores podem acessar esta p\xe1gina."})]})}):u?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),(0,t.jsx)("span",{children:"Carregando usu\xe1rios..."})]})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Gest\xe3o de Usu\xe1rios"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Gerencie usu\xe1rios e convites do projeto"})]}),(0,t.jsxs)(m,{onClick:()=>p(!0),children:[(0,t.jsx)(ay.Z,{className:"mr-2 h-4 w-4"}),"Convidar Usu\xe1rio"]})]}),(0,t.jsxs)(O,{children:[(0,t.jsx)(P,{children:(0,t.jsxs)(q,{className:"flex items-center gap-2",children:[(0,t.jsx)(v.Z,{className:"h-5 w-5"}),"Usu\xe1rios do Projeto"]})}),(0,t.jsxs)(A,{children:[(0,t.jsxs)(ev,{children:[(0,t.jsx)(eg,{children:(0,t.jsxs)(ey,{children:[(0,t.jsx)(eb,{children:"Usu\xe1rio"}),(0,t.jsx)(eb,{children:"Email"}),(0,t.jsx)(eb,{children:"Role"}),(0,t.jsx)(eb,{children:"Status"}),(0,t.jsx)(eb,{children:"Data de Entrada"}),(0,t.jsx)(eb,{children:"A\xe7\xf5es"})]})}),(0,t.jsx)(eN,{children:o.map(e=>{var a,s,r,n;return(0,t.jsxs)(ey,{children:[(0,t.jsx)(ew,{className:"font-medium",children:(null===(a=e.user)||void 0===a?void 0:a.name)||"Nome n\xe3o informado"}),(0,t.jsx)(ew,{children:null===(s=e.user)||void 0===s?void 0:s.email}),(0,t.jsx)(ew,{children:(0,t.jsx)(L,{className:k(e.role),children:e.role})}),(0,t.jsx)(ew,{children:(0,t.jsx)(L,{className:E(e.status),children:e.status})}),(0,t.jsx)(ew,{children:new Date(e.joinedAt).toLocaleDateString("pt-BR")}),(0,t.jsx)(ew,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(ee,{htmlFor:"status-".concat(e.id),className:"text-sm",children:"ATIVO"===e.status?"Ativo":"Inativo"}),(0,t.jsx)(aN,{id:"status-".concat(e.id),checked:"ATIVO"===e.status,onCheckedChange:()=>S(e.id,e.status),disabled:(null===(r=e.user)||void 0===r?void 0:r.role)==="GESTOR"})]}),(0,t.jsx)(m,{variant:"outline",size:"sm",onClick:()=>{var a;return C(e.id,(null===(a=e.user)||void 0===a?void 0:a.name)||"Usu\xe1rio")},disabled:(null===(n=e.user)||void 0===n?void 0:n.id)===i,className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:"Remover"})]})})]},e.id)})})]}),0===o.length&&(0,t.jsx)("div",{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"Nenhum usu\xe1rio encontrado"})})]})]}),(0,t.jsxs)(O,{children:[(0,t.jsx)(P,{children:(0,t.jsxs)(q,{className:"flex items-center gap-2",children:[(0,t.jsx)(eX.Z,{className:"h-5 w-5"}),"Convites Pendentes"]})}),(0,t.jsxs)(A,{children:[(0,t.jsxs)(ev,{children:[(0,t.jsx)(eg,{children:(0,t.jsxs)(ey,{children:[(0,t.jsx)(eb,{children:"Nome"}),(0,t.jsx)(eb,{children:"Email"}),(0,t.jsx)(eb,{children:"Role"}),(0,t.jsx)(eb,{children:"Status"}),(0,t.jsx)(eb,{children:"Data do Convite"})]})}),(0,t.jsx)(eN,{children:d.map(e=>(0,t.jsxs)(ey,{children:[(0,t.jsx)(ew,{className:"font-medium",children:e.name}),(0,t.jsx)(ew,{children:e.email}),(0,t.jsx)(ew,{children:(0,t.jsx)(L,{className:k(e.role),children:e.role})}),(0,t.jsx)(ew,{children:(0,t.jsx)(L,{className:E(e.status),children:e.status})}),(0,t.jsx)(ew,{children:new Date(e.createdAt).toLocaleDateString("pt-BR")})]},e.id))})]}),0===d.length&&(0,t.jsx)("div",{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"Nenhum convite pendente"})})]})]}),(0,t.jsx)(_,{open:h,onOpenChange:p,children:(0,t.jsxs)(G,{children:[(0,t.jsxs)(J,{children:[(0,t.jsx)($,{children:"Convidar Usu\xe1rio"}),(0,t.jsx)(H,{children:"Envie um convite para um novo usu\xe1rio participar do projeto"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(ee,{htmlFor:"invite-name",children:"Nome *"}),(0,t.jsx)(X,{id:"invite-name",value:j.name,onChange:e=>f(a=>({...a,name:e.target.value})),placeholder:"Nome completo do usu\xe1rio",disabled:g})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(ee,{htmlFor:"invite-email",children:"Email *"}),(0,t.jsx)(X,{id:"invite-email",type:"email",value:j.email,onChange:e=>f(a=>({...a,email:e.target.value})),placeholder:"email@exemplo.com",disabled:g})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(ee,{htmlFor:"invite-role",children:"Role"}),(0,t.jsxs)(au,{value:j.role,onValueChange:e=>f(a=>({...a,role:e})),disabled:g,children:[(0,t.jsx)(ah,{children:(0,t.jsx)(ax,{placeholder:"Selecione uma role"})}),(0,t.jsxs)(af,{children:[(0,t.jsx)(av,{value:"COLABORADOR",children:"Colaborador"}),(0,t.jsx)(av,{value:"GESTOR",children:"Gestor"})]})]})]})]}),(0,t.jsxs)(Y,{children:[(0,t.jsx)(m,{variant:"outline",onClick:()=>p(!1),disabled:g,children:"Cancelar"}),(0,t.jsx)(m,{onClick:w,disabled:g,children:g?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Enviando..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eX.Z,{className:"mr-2 h-4 w-4"}),"Enviar Convite"]})})]})]})})]})}function aw(){let[e,a]=(0,r.useState)("login"),[s,i]=(0,r.useState)(!1),[n,o]=(0,r.useState)(null),[l,d]=(0,r.useState)(null),{fetchMaterials:c,fetchMovements:m,setCurrentProjectId:u,clearData:x,setCurrentUserId:h}=M(),p=e=>{e&&e.id&&e.email?(o(e),a("projects")):(console.error("Dados de usu\xe1rio inv\xe1lidos:",e),a("login"))},j=e=>{e&&e.id&&e.email?(o(e),a("projects")):(console.error("Dados de usu\xe1rio inv\xe1lidos:",e),a("login"))},f=async e=>{if(e&&n){var s;console.log("Projeto selecionado:",e),console.log("Projetos dispon\xedveis:",n.projects);let t=null===(s=n.projects)||void 0===s?void 0:s.find(a=>a.id===e);if(!t)try{console.log("Projeto n\xe3o encontrado localmente, buscando do banco...");let a=await fetch("/api/auth/projects?userId=".concat(n.id));if(a.ok){let s=await a.json();(t=s.find(a=>a.id===e))&&o(e=>e?{...e,projects:s}:null)}}catch(e){console.error("Erro ao buscar projeto do banco:",e)}if(t){console.log("Projeto encontrado:",t),d(t),u(e),h(n.id);try{console.log("Buscando role do usu\xe1rio no projeto...");let a=await fetch("/api/projects/".concat(e,"/members"));if(a.ok){let e=(await a.json()).find(e=>e.userId===n.id);e&&(console.log("Role do usu\xe1rio no projeto:",e.role),o(a=>a?{...a,projectRole:e.role}:null))}}catch(e){console.error("Erro ao buscar role do usu\xe1rio no projeto:",e)}try{await c(e),await m(e)}catch(e){console.error("Erro ao carregar dados do projeto:",e)}a("dashboard")}else console.error("Projeto n\xe3o encontrado:",e),a("projects")}else console.error("Projeto inv\xe1lido ou usu\xe1rio n\xe3o autenticado"),a("projects")},v=()=>{switch(e){case"login":return(0,t.jsx)(al,{onLogin:p,goToSignup:()=>a("signup")});case"signup":return(0,t.jsx)(an,{onSignup:j,goToLogin:()=>a("login")});case"projects":return n?(0,t.jsx)(ao,{user:n,onSelectProject:f}):(0,t.jsxs)("div",{className:"text-center mt-12",children:[(0,t.jsx)("p",{className:"text-red-600",children:"Usu\xe1rio n\xe3o autenticado"}),(0,t.jsx)("button",{onClick:()=>a("login"),className:"mt-4 px-4 py-2 bg-primary text-white rounded",children:"Voltar ao Login"})]});case"dashboard":return n&&l?(0,t.jsx)(ef,{setCurrentPage:a}):(0,t.jsxs)("div",{className:"text-center mt-12",children:[(0,t.jsx)("p",{className:"text-red-600",children:"Usu\xe1rio n\xe3o autenticado ou projeto n\xe3o selecionado"}),(0,t.jsx)("button",{onClick:()=>a("projects"),className:"mt-4 px-4 py-2 bg-primary text-white rounded",children:"Selecionar Projeto"})]});case"materials":return n&&l?(0,t.jsx)(eI,{}):(0,t.jsxs)("div",{className:"text-center mt-12",children:[(0,t.jsx)("p",{className:"text-red-600",children:"Usu\xe1rio n\xe3o autenticado ou projeto n\xe3o selecionado"}),(0,t.jsx)("button",{onClick:()=>a("projects"),className:"mt-4 px-4 py-2 bg-primary text-white rounded",children:"Selecionar Projeto"})]});case"scanner":return n&&l?(0,t.jsx)(eQ,{}):(0,t.jsxs)("div",{className:"text-center mt-12",children:[(0,t.jsx)("p",{className:"text-red-600",children:"Usu\xe1rio n\xe3o autenticado ou projeto n\xe3o selecionado"}),(0,t.jsx)("button",{onClick:()=>a("projects"),className:"mt-4 px-4 py-2 bg-primary text-white rounded",children:"Selecionar Projeto"})]});case"movements":return n&&l?(0,t.jsx)(eW,{}):(0,t.jsxs)("div",{className:"text-center mt-12",children:[(0,t.jsx)("p",{className:"text-red-600",children:"Usu\xe1rio n\xe3o autenticado ou projeto n\xe3o selecionado"}),(0,t.jsx)("button",{onClick:()=>a("projects"),className:"mt-4 px-4 py-2 bg-primary text-white rounded",children:"Selecionar Projeto"})]});case"profile":return n&&l?(0,t.jsx)(e5,{user:{id:n.id,name:n.name||"",email:n.email,role:n.projectRole||n.role||"COLABORADOR",createdAt:new Date().toISOString(),lastLogin:new Date().toISOString()},onUpdateProfile:e=>{o(a=>a?{...a,...e}:null)}}):(0,t.jsxs)("div",{className:"text-center mt-12",children:[(0,t.jsx)("p",{className:"text-red-600",children:"Usu\xe1rio n\xe3o autenticado ou projeto n\xe3o selecionado"}),(0,t.jsx)("button",{onClick:()=>a("projects"),className:"mt-4 px-4 py-2 bg-primary text-white rounded",children:"Selecionar Projeto"})]});case"users":return n&&l?(0,t.jsx)(ab,{projectId:l.id,currentUserRole:n.projectRole||n.role||"COLABORADOR",currentUserId:n.id}):(0,t.jsxs)("div",{className:"text-center mt-12",children:[(0,t.jsx)("p",{className:"text-red-600",children:"Usu\xe1rio n\xe3o autenticado ou projeto n\xe3o selecionado"}),(0,t.jsx)("button",{onClick:()=>a("projects"),className:"mt-4 px-4 py-2 bg-primary text-white rounded",children:"Selecionar Projeto"})]});default:return(0,t.jsxs)("div",{className:"text-center mt-12",children:[(0,t.jsx)("p",{className:"text-red-600",children:"P\xe1gina n\xe3o encontrada"}),(0,t.jsx)("button",{onClick:()=>a("dashboard"),className:"mt-4 px-4 py-2 bg-primary text-white rounded",children:"Voltar ao Dashboard"})]})}};return(0,t.jsx)(e6,{attribute:"class",defaultTheme:"system",enableSystem:!0,children:(0,t.jsxs)(ex,{children:[(0,t.jsx)("div",{className:"flex h-screen bg-background",children:n&&l&&"login"!==e&&"signup"!==e&&"projects"!==e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b,{currentPage:e,setCurrentPage:a,sidebarOpen:s,setSidebarOpen:i,onLogout:()=>{o(null),d(null),a("login"),i(!1),x()},onBackToProjects:()=>{a("projects")},currentUserRole:n.projectRole||n.role||"COLABORADOR",projectName:null==l?void 0:l.name}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,t.jsx)(T,{currentPage:e,setSidebarOpen:i,projectName:null==l?void 0:l.name}),(0,t.jsx)("main",{className:"flex-1 overflow-auto p-4 md:p-6",children:v()})]})]}):(0,t.jsx)("div",{className:"flex-1 flex flex-col overflow-hidden",children:(0,t.jsx)("main",{className:"flex-1 overflow-auto p-4 md:p-6",children:v()})})}),(0,t.jsx)(ar,{})]})})}}},function(e){e.O(0,[52,376,971,117,744],function(){return e(e.s=1694)}),_N_E=e.O()}]);