"use strict";(()=>{var e={};e.id=864,e.ids=[864],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8042:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>g,patchFetch:()=>j,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>c});var r={};a.r(r),a.d(r,{GET:()=>d,POST:()=>m,dynamic:()=>u});var o=a(9303),i=a(8716),n=a(670),s=a(7070);let u="force-dynamic";async function d(e){try{let{searchParams:t}=new URL(e.url),r=t.get("projectId");if(!r)return s.NextResponse.json({message:"ID do projeto \xe9 obrigat\xf3rio"},{status:400});let{PrismaClient:o}=await Promise.resolve().then(a.t.bind(a,3524,23)),i=new o;try{let e=(await i.movementRecord.findMany({where:{projectId:r},include:{user:{select:{name:!0}},material:{select:{name:!0,type:!0}}},orderBy:{timestamp:"desc"}})).map(e=>({id:e.id,userId:e.userId,userName:e.user.name||"Usu\xe1rio",actionType:"entry"===e.type?"entrada":"sa\xedda",materialId:e.materialId,materialName:e.material.name,materialCategory:e.material.type||"Geral",quantity:e.quantity,date:e.timestamp,location:"Local do Projeto",justification:"Movimenta\xe7\xe3o de estoque"}));return s.NextResponse.json(e)}finally{await i.$disconnect()}}catch(e){return console.error("Erro ao buscar movimenta\xe7\xf5es:",e),s.NextResponse.json({message:"Erro interno do servidor"},{status:500})}}async function m(e){try{let{quantity:t,type:r,userId:o,materialId:i,projectId:n,justification:u="Movimenta\xe7\xe3o de estoque"}=await e.json(),d=[];if(t||0===t||d.push("Quantidade \xe9 obrigat\xf3ria"),r||d.push("Tipo \xe9 obrigat\xf3rio"),o||d.push("Usu\xe1rio \xe9 obrigat\xf3rio"),i||d.push("Material \xe9 obrigat\xf3rio"),n||d.push("Projeto \xe9 obrigat\xf3rio"),d.length>0)return s.NextResponse.json({message:"Campos obrigat\xf3rios n\xe3o preenchidos: "+d.join(", "),errors:d},{status:400});let{PrismaClient:m}=await Promise.resolve().then(a.t.bind(a,3524,23)),p=new m;try{if(!await p.material.findUnique({where:{id:i}}))return s.NextResponse.json({message:"Material n\xe3o encontrado"},{status:404});if(!await p.project.findUnique({where:{id:n}}))return s.NextResponse.json({message:"Projeto n\xe3o encontrado"},{status:404});if(!await p.user.findUnique({where:{id:o}}))return s.NextResponse.json({message:"Usu\xe1rio n\xe3o encontrado"},{status:404});let e="entrada"===r?"entry":"exit",a=await p.movementRecord.create({data:{quantity:parseFloat(t),type:e,userId:o,materialId:i,projectId:n},include:{user:{select:{name:!0}},material:{select:{name:!0,type:!0}}}});"entry"===e?await p.material.update({where:{id:i},data:{currentQuantity:{increment:parseFloat(t)||0}}}):"exit"===e&&await p.material.update({where:{id:i},data:{currentQuantity:{decrement:parseFloat(t)||0}}});let d={id:a.id,userId:a.userId,userName:a.user.name||"Usu\xe1rio",actionType:"entry"===a.type?"entrada":"sa\xedda",materialId:a.materialId,materialName:a.material.name,materialCategory:a.material.type||"Geral",quantity:a.quantity,date:a.timestamp,location:"Local do Projeto",justification:u};return s.NextResponse.json(d,{status:201})}finally{await p.$disconnect()}}catch(e){return console.error("Erro ao criar movimenta\xe7\xe3o:",e),s.NextResponse.json({message:"Erro interno do servidor"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/movements/route",pathname:"/api/movements",filename:"route",bundlePath:"app/api/movements/route"},resolvedPagePath:"/Users/jvalegri/tcc-jvalegri-1/app/api/movements/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:y}=p,g="/api/movements/route";function j(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:c})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,972],()=>a(8042));module.exports=r})();