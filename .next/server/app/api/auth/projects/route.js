"use strict";(()=>{var e={};e.id=190,e.ids=[190],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6563:(e,o,r)=>{r.r(o),r.d(o,{originalPathname:()=>x,patchFetch:()=>w,requestAsyncStorage:()=>j,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var t={};r.r(t),r.d(t,{GET:()=>d,POST:()=>l,dynamic:()=>u});var s=r(9303),a=r(8716),n=r(670),i=r(7070),c=r(3524);let u="force-dynamic",p=new c.PrismaClient;async function d(e){try{let{searchParams:o}=new URL(e.url),r=o.get("userId");if(!r)return i.NextResponse.json({message:"ID do usu\xe1rio \xe9 obrigat\xf3rio."},{status:400});console.log("Buscando projetos para usu\xe1rio:",r);let t=await p.project.findMany({where:{ownerId:r},select:{id:!0,name:!0,description:!0}});return console.log(`Encontrados ${t.length} projetos para usu\xe1rio ${r}`),i.NextResponse.json(t)}catch(e){return console.error("Erro ao buscar projetos:",e),i.NextResponse.json({message:"Erro interno do servidor."},{status:500})}finally{await p.$disconnect()}}async function l(e){try{let{name:o,description:r,userId:t}=await e.json();if(console.log("Tentativa de criar projeto:",{name:o,description:r,userId:t}),!o||!t)return console.log("Campos obrigat\xf3rios faltando:",{name:!!o,userId:!!t}),i.NextResponse.json({message:"Nome do projeto e ID do usu\xe1rio s\xe3o obrigat\xf3rios."},{status:400});if(!await p.user.findUnique({where:{id:t}}))return console.log("Usu\xe1rio n\xe3o encontrado:",t),i.NextResponse.json({message:"Usu\xe1rio n\xe3o encontrado."},{status:404});console.log("Usu\xe1rio encontrado, criando projeto...");let s=await p.$transaction(async e=>{let s=await e.project.create({data:{name:o.trim(),description:r?.trim()||null,ownerId:t},select:{id:!0,name:!0,description:!0}});console.log("Projeto criado:",s);let a=await e.projectMember.create({data:{projectId:s.id,userId:t,role:"GESTOR",status:"ATIVO"}});return console.log("Membro do projeto criado automaticamente:",a),s});return console.log("Projeto e membro criados com sucesso:",s),i.NextResponse.json(s,{status:201})}catch(e){return console.error("Erro ao criar projeto:",e),i.NextResponse.json({message:"Erro interno do servidor."},{status:500})}finally{await p.$disconnect()}}let m=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/projects/route",pathname:"/api/auth/projects",filename:"route",bundlePath:"app/api/auth/projects/route"},resolvedPagePath:"/Users/jvalegri/tcc-jvalegri-1/app/api/auth/projects/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:j,staticGenerationAsyncStorage:g,serverHooks:h}=m,x="/api/auth/projects/route";function w(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}}};var o=require("../../../../webpack-runtime.js");o.C(e);var r=e=>o(o.s=e),t=o.X(0,[276,972],()=>r(6563));module.exports=t})();