"use strict";(()=>{var e={};e.id=864,e.ids=[864],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5158:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>j,patchFetch:()=>P,requestAsyncStorage:()=>g,routeModule:()=>c,serverHooks:()=>y,staticGenerationAsyncStorage:()=>v});var o={};a.r(o),a.d(o,{GET:()=>u,POST:()=>p,dynamic:()=>l});var r=a(9303),n=a(8716),i=a(670),s=a(7070),m=a(3524);let l="force-dynamic",d=new m.PrismaClient;async function u(e){try{let{searchParams:t}=new URL(e.url),a=t.get("projectId");if(!a)return s.NextResponse.json({message:"ID do projeto \xe9 obrigat\xf3rio."},{status:400});let o=(await d.movementRecord.findMany({where:{projectId:a},include:{user:{select:{name:!0}},material:{select:{name:!0,type:!0}}},orderBy:{timestamp:"desc"}})).map(e=>({id:e.id,userId:e.userId,userName:e.user.name||"Usu\xe1rio",actionType:"entry"===e.type?"entrada":"sa\xedda",materialId:e.materialId,materialName:e.material.name,materialCategory:e.material.type||"Geral",quantity:e.quantity,date:e.timestamp,location:"Local do Projeto",justification:"Movimenta\xe7\xe3o de estoque"}));return s.NextResponse.json(o)}catch(e){return console.error("Erro ao buscar movimenta\xe7\xf5es:",e),s.NextResponse.json({message:"Erro interno do servidor."},{status:500})}finally{await d.$disconnect()}}async function p(e){try{let t=await e.json();console.log("POST /api/movements - Body recebido:",t);let{quantity:a,type:o,userId:r,materialId:n,projectId:i,justification:m="Movimenta\xe7\xe3o de estoque"}=t;console.log("POST /api/movements - Dados extra\xeddos:",{quantity:a,type:o,userId:r,materialId:n,projectId:i,justification:m});let l=[];if(a||0===a||l.push("Quantidade \xe9 obrigat\xf3ria"),o||l.push("Tipo \xe9 obrigat\xf3rio"),r||l.push("Usu\xe1rio \xe9 obrigat\xf3rio"),n||l.push("Material \xe9 obrigat\xf3rio"),i||l.push("Projeto \xe9 obrigat\xf3rio"),l.length>0)return console.log("POST /api/movements - Valida\xe7\xe3o falhou:",l),s.NextResponse.json({message:"Campos obrigat\xf3rios n\xe3o preenchidos: "+l.join(", "),errors:l},{status:400});let u=await d.material.findUnique({where:{id:n}});if(!u)return console.log("POST /api/movements - Material n\xe3o encontrado:",n),s.NextResponse.json({message:"Material n\xe3o encontrado."},{status:404});console.log("POST /api/movements - Material encontrado:",u);let p=await d.project.findUnique({where:{id:i}});if(!p)return console.log("POST /api/movements - Projeto n\xe3o encontrado:",i),s.NextResponse.json({message:"Projeto n\xe3o encontrado."},{status:404});console.log("POST /api/movements - Projeto encontrado:",p);let c=await d.user.findUnique({where:{id:r}});if(!c)return console.log("POST /api/movements - Usu\xe1rio n\xe3o encontrado:",r),s.NextResponse.json({message:"Usu\xe1rio n\xe3o encontrado."},{status:404});console.log("POST /api/movements - Usu\xe1rio encontrado:",c);let g="entrada"===o?"entry":"exit";console.log("POST /api/movements - Tipo mapeado:",{original:o,mapped:g});let v=await d.movementRecord.create({data:{quantity:parseFloat(a),type:g,userId:r,materialId:n,projectId:i},include:{user:{select:{name:!0}},material:{select:{name:!0,type:!0}}}});console.log("POST /api/movements - Movimenta\xe7\xe3o criada:",v),"entry"===g?await d.material.update({where:{id:n},data:{currentQuantity:{increment:parseFloat(a)||0}}}):"exit"===g&&await d.material.update({where:{id:n},data:{currentQuantity:{decrement:parseFloat(a)||0}}}),console.log("POST /api/movements - Quantidade do material atualizada");let y={id:v.id,userId:v.userId,userName:v.user.name||"Usu\xe1rio",actionType:"entry"===v.type?"entrada":"sa\xedda",materialId:v.materialId,materialName:v.material.name,materialCategory:v.material.type||"Geral",quantity:v.quantity,date:v.timestamp,location:"Local do Projeto",justification:m};return console.log("POST /api/movements - Retornando resposta:",y),s.NextResponse.json(y,{status:201})}catch(e){return console.error("POST /api/movements - Erro ao criar movimenta\xe7\xe3o:",e),s.NextResponse.json({message:"Erro interno do servidor."},{status:500})}finally{await d.$disconnect()}}let c=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/movements/route",pathname:"/api/movements",filename:"route",bundlePath:"app/api/movements/route"},resolvedPagePath:"/Users/jvalegri/tcc-jvalegri-1/app/api/movements/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:v,serverHooks:y}=c,j="/api/movements/route";function P(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:v})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),o=t.X(0,[276,972],()=>a(5158));module.exports=o})();