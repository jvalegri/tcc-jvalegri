"use strict";(()=>{var e={};e.id=149,e.ids=[149],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3672:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>w,requestAsyncStorage:()=>d,routeModule:()=>m,serverHooks:()=>j,staticGenerationAsyncStorage:()=>y});var a={};r.r(a),r.d(a,{GET:()=>l,POST:()=>c,PUT:()=>p,dynamic:()=>u});var i=r(9303),n=r(8716),o=r(670),s=r(7070);let u="force-dynamic";async function l(e){try{let{searchParams:t}=new URL(e.url),a=t.get("projectId");if(!a)return s.NextResponse.json({message:"ID do projeto \xe9 obrigat\xf3rio"},{status:400});let{PrismaClient:i}=await Promise.resolve().then(r.t.bind(r,3524,23)),n=new i;try{let e=(await n.projectMaterial.findMany({where:{projectId:a},include:{material:!0}})).map(e=>({id:e.material.id,name:e.material.name,category:e.material.type||"Geral",supplier:e.material.supplier||"Fornecedor",quantity:e.material.currentQuantity,unit:e.material.unit,price:e.material.price||0,status:e.material.currentQuantity<=0?"Sem Estoque":e.material.currentQuantity<=(e.material.minStock||5)?"Estoque Baixo":"Em Estoque",minStock:e.material.minStock||5,notes:e.material.description||void 0}));return s.NextResponse.json(e)}finally{await n.$disconnect()}}catch(e){return console.error("Erro ao buscar materiais:",e),s.NextResponse.json({message:"Erro interno do servidor"},{status:500})}}async function c(e){try{let{name:t,description:a,type:i,currentQuantity:n,unit:o,isConsumable:u,projectId:l,price:c,supplier:p,minStock:m}=await e.json();if(!t||void 0===n||!o||!l)return s.NextResponse.json({message:"Nome, quantidade, unidade e ID do projeto s\xe3o obrigat\xf3rios"},{status:400});let{PrismaClient:d}=await Promise.resolve().then(r.t.bind(r,3524,23)),y=new d;try{if(!await y.project.findUnique({where:{id:l}}))return s.NextResponse.json({message:"Projeto n\xe3o encontrado"},{status:404});let e=await y.material.create({data:{name:t.trim(),description:a?.trim()||null,type:i?.trim()||null,currentQuantity:parseFloat(n),unit:o.trim(),price:parseFloat(c||0),supplier:p?.trim()||null,minStock:parseFloat(m||5),isConsumable:u||!1}});await y.projectMaterial.create({data:{projectId:l,materialId:e.id}});let r={id:e.id,name:e.name,category:e.type||"Geral",supplier:e.supplier||"Fornecedor",quantity:e.currentQuantity,unit:e.unit,price:e.price||0,status:e.currentQuantity<=0?"Sem Estoque":e.currentQuantity<=(e.minStock||5)?"Estoque Baixo":"Em Estoque",minStock:e.minStock||5,notes:e.description||void 0};return s.NextResponse.json(r,{status:201})}finally{await y.$disconnect()}}catch(e){return console.error("Erro ao criar material:",e),s.NextResponse.json({message:"Erro interno do servidor"},{status:500})}}async function p(e){try{let{id:t,name:a,description:i,type:n,currentQuantity:o,unit:u,price:l,supplier:c,minStock:p}=await e.json();if(!t||!a||void 0===o||!u)return s.NextResponse.json({message:"ID, nome, quantidade e unidade s\xe3o obrigat\xf3rios"},{status:400});let{PrismaClient:m}=await Promise.resolve().then(r.t.bind(r,3524,23)),d=new m;try{if(!await d.material.findUnique({where:{id:t}}))return s.NextResponse.json({message:"Material n\xe3o encontrado"},{status:404});let e=await d.material.update({where:{id:t},data:{name:a.trim(),description:i?.trim()||null,type:n?.trim()||null,currentQuantity:parseFloat(o),unit:u.trim(),price:parseFloat(l||0),supplier:c?.trim()||null,minStock:parseFloat(p||5)}}),r={id:e.id,name:e.name,category:e.type||"Geral",supplier:e.supplier||"Fornecedor",quantity:e.currentQuantity,unit:e.unit,price:e.price||0,status:e.currentQuantity<=0?"Sem Estoque":e.currentQuantity<=(e.minStock||5)?"Estoque Baixo":"Em Estoque",minStock:e.minStock||5,notes:e.description||void 0};return s.NextResponse.json(r)}finally{await d.$disconnect()}}catch(e){return console.error("Erro ao atualizar material:",e),s.NextResponse.json({message:"Erro interno do servidor"},{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/materials/route",pathname:"/api/materials",filename:"route",bundlePath:"app/api/materials/route"},resolvedPagePath:"/Users/jvalegri/tcc-jvalegri-1/app/api/materials/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:y,serverHooks:j}=m,g="/api/materials/route";function w(){return(0,o.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:y})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972],()=>r(3672));module.exports=a})();