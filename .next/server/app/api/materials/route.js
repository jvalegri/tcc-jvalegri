"use strict";(()=>{var e={};e.id=149,e.ids=[149],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3490:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>q,patchFetch:()=>f,requestAsyncStorage:()=>g,routeModule:()=>y,serverHooks:()=>x,staticGenerationAsyncStorage:()=>j});var r={};a.r(r),a.d(r,{GET:()=>p,POST:()=>m,PUT:()=>d,dynamic:()=>l});var i=a(9303),o=a(8716),n=a(670),s=a(7070),u=a(3524);let l="force-dynamic",c=new u.PrismaClient;async function p(e){try{let{searchParams:t}=new URL(e.url),a=t.get("projectId");if(!a)return s.NextResponse.json({message:"ID do projeto \xe9 obrigat\xf3rio."},{status:400});let r=(await c.projectMaterial.findMany({where:{projectId:a},include:{material:!0}})).map(e=>({id:e.material.id,name:e.material.name,category:e.material.type||"Geral",supplier:e.material.supplier||"Fornecedor",quantity:e.material.currentQuantity,unit:e.material.unit,price:e.material.price||0,status:e.material.currentQuantity<=0?"Sem Estoque":e.material.currentQuantity<=(e.material.minStock||5)?"Estoque Baixo":"Em Estoque",minStock:e.material.minStock||5,notes:e.material.description||void 0}));return s.NextResponse.json(r)}catch(e){return console.error("Erro ao buscar materiais:",e),s.NextResponse.json({message:"Erro interno do servidor."},{status:500})}finally{await c.$disconnect()}}async function m(e){try{let{name:t,description:a,type:r,currentQuantity:i,unit:o,isConsumable:n,projectId:u,price:l,supplier:p,minStock:m}=await e.json();if(!t||void 0===i||!o||!u)return s.NextResponse.json({message:"Nome, quantidade, unidade e ID do projeto s\xe3o obrigat\xf3rios."},{status:400});if(!await c.project.findUnique({where:{id:u}}))return s.NextResponse.json({message:"Projeto n\xe3o encontrado."},{status:404});let d=await c.material.create({data:{name:t.trim(),description:a?.trim()||null,type:r?.trim()||null,currentQuantity:parseFloat(i),unit:o.trim(),price:parseFloat(l||0),supplier:p?.trim()||null,minStock:parseFloat(m||5),isConsumable:n||!1}});await c.projectMaterial.create({data:{projectId:u,materialId:d.id}});let y={id:d.id,name:d.name,category:d.type||"Geral",supplier:d.supplier||"Fornecedor",quantity:d.currentQuantity,unit:d.unit,price:d.price||0,status:d.currentQuantity<=0?"Sem Estoque":d.currentQuantity<=(d.minStock||5)?"Estoque Baixo":"Em Estoque",minStock:d.minStock||5,notes:d.description||void 0};return s.NextResponse.json(y,{status:201})}catch(e){return console.error("Erro ao criar material:",e),s.NextResponse.json({message:"Erro interno do servidor."},{status:500})}finally{await c.$disconnect()}}async function d(e){try{let t=await e.json();console.log("PUT /api/materials - Body recebido:",t);let{id:a,name:r,description:i,type:o,currentQuantity:n,unit:u,price:l,supplier:p,minStock:m}=t;if(!a||!r||void 0===n||!u)return console.log("PUT /api/materials - Valida\xe7\xe3o falhou:",{id:a,name:r,currentQuantity:n,unit:u}),s.NextResponse.json({message:"ID, nome, quantidade e unidade s\xe3o obrigat\xf3rios."},{status:400});let d=await c.material.findUnique({where:{id:a}});if(!d)return console.log("PUT /api/materials - Material n\xe3o encontrado:",a),s.NextResponse.json({message:"Material n\xe3o encontrado."},{status:404});console.log("PUT /api/materials - Material encontrado:",d),console.log("PUT /api/materials - Dados para atualiza\xe7\xe3o:",{name:r.trim(),description:i?.trim()||null,type:o?.trim()||null,currentQuantity:parseFloat(n),unit:u.trim(),price:parseFloat(l||0),supplier:p?.trim()||null,minStock:parseFloat(m||5)});let y=await c.material.update({where:{id:a},data:{name:r.trim(),description:i?.trim()||null,type:o?.trim()||null,currentQuantity:parseFloat(n),unit:u.trim(),price:parseFloat(l||0),supplier:p?.trim()||null,minStock:parseFloat(m||5)}});console.log("PUT /api/materials - Material atualizado com sucesso:",y);let g={id:y.id,name:y.name,category:y.type||"Geral",supplier:y.supplier||"Fornecedor",quantity:y.currentQuantity,unit:y.unit,price:y.price||0,status:y.currentQuantity<=0?"Sem Estoque":y.currentQuantity<=(y.minStock||5)?"Estoque Baixo":"Em Estoque",minStock:y.minStock||5,notes:y.description||void 0};return s.NextResponse.json(g)}catch(e){return console.error("PUT /api/materials - Erro ao atualizar material:",e),s.NextResponse.json({message:"Erro interno do servidor."},{status:500})}finally{await c.$disconnect()}}let y=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/materials/route",pathname:"/api/materials",filename:"route",bundlePath:"app/api/materials/route"},resolvedPagePath:"/Users/jvalegri/tcc-jvalegri-1/app/api/materials/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:j,serverHooks:x}=y,q="/api/materials/route";function f(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:j})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,972],()=>a(3490));module.exports=r})();